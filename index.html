<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>êµ¬ë¡€ì¤‘ ì‹¤ì‹œê°„ í•™ì‚¬ë ¥</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Pretendard:wght@400;700;900&display=swap');
        body { font-family: 'Pretendard', sans-serif; background-color: #f8fafc; }
        
        /* ëª¨ë°”ì¼ ì›”ê°„ ê³„íš ìµœì í™” */
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 1px; background-color: #e2e8f0; border: 1px solid #e2e8f0; border-radius: 12px; overflow: hidden; }
        .day-cell { min-height: 80px; background-color: white; padding: 4px; position: relative; cursor: pointer; transition: background-color 0.2s; }
        @media (min-width: 768px) { .day-cell { min-height: 120px; padding: 8px; } }
        
        .day-cell:hover { background-color: #f1f5f9; }
        
        /* ì¼ì • ì•„ì´í…œ ìŠ¤íƒ€ì¼ ë° ë¶€ì„œë³„ ìƒ‰ìƒ */
        .event-item { font-size: 9px; padding: 2px 4px; margin-top: 2px; border-radius: 3px; background-color: #f1f5f9; border-left: 2px solid #6366f1; font-weight: 700; display: flex; justify-content: space-between; overflow: hidden; white-space: nowrap; text-overflow: ellipsis; }
        @media (min-width: 768px) { 
            .event-item { 
                font-size: 11px; 
                padding: 4px 6px; 
                margin-top: 4px; 
                border-radius: 4px; 
                border-left-width: 3px; 
                white-space: normal; /* PCì—ì„œëŠ” í…ìŠ¤íŠ¸ ì¤„ë°”ê¿ˆ í—ˆìš© */
                word-break: break-all;
            } 
        }
        
        /* ë¶€ì„œë³„ í…ìŠ¤íŠ¸ ìƒ‰ìƒ (ë¹¨ê°„ìƒ‰ ì œì™¸) */
        .dept-êµë¬´ { color: #4338ca; border-left-color: #4338ca; }
        .dept-ì—°êµ¬ { color: #059669; border-left-color: #059669; }
        .dept-í•™ìƒ { color: #d97706; border-left-color: #d97706; }
        .dept-ì°½ì˜ { color: #7c3aed; border-left-color: #7c3aed; }
        .dept-í–‰ì • { color: #475569; border-left-color: #475569; }
        .dept-1í•™ë…„ { color: #2563eb; border-left-color: #2563eb; }
        .dept-2í•™ë…„ { color: #db2777; border-left-color: #db2777; }
        .dept-3í•™ë…„ { color: #0891b2; border-left-color: #0891b2; }
        .dept-í•™ì‚¬ { color: #1e293b; border-left-color: #1e293b; }

        .holiday-badge { font-size: 9px; color: #dc2626; font-weight: 700; margin-top: 1px; }
        .text-sun { color: #ef4444; } .text-sat { color: #3b82f6; }
        .del-x { color: #ef4444; cursor: pointer; margin-left: 4px; font-weight: bold; }
        
        .year-view { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 16px; }
        .year-month { background: white; padding: 16px; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .year-month-title { font-weight: 900; color: #1e293b; margin-bottom: 8px; }
        .mini-calendar { display: grid; grid-template-columns: repeat(7, 1fr); gap: 2px; font-size: 10px; }
        .mini-day { padding: 4px; text-align: center; min-height: 30px; background: #f8fafc; border-radius: 4px; cursor: pointer; }
        .mini-day.has-event { background: #dbeafe; font-weight: 700; }
        .mini-day.weekend { background: #fee2e2; }
        
        .week-item { background-color: white; }
        
        /* ë°°ê²½ìƒ‰ ì„¤ì •: ì£¼ë§ ë° íœ´ì—…ì¼ */
        .weekend-bg, .holiday-bg { background-color: #fff1f2 !important; }
        
        .sync-indicator { position: fixed; bottom: 20px; right: 20px; background: #4f46e5; color: white; padding: 8px 16px; border-radius: 20px; font-size: 11px; font-weight: 700; box-shadow: 0 4px 6px rgba(0,0,0,0.1); z-index: 1000; }
        .sync-indicator.syncing { background: #f59e0b; animation: pulse 1s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        
        /* ì£¼ê°„ ì•ˆë‚´ì‚¬í•­ ìŠ¤íƒ€ì¼ */
        .notice-section { background-color: white; padding: 20px; border-radius: 16px; border: 1px solid #e2e8f0; margin-top: 20px; }
        .notice-list { display: flex; flex-direction: column; gap: 12px; }
        .notice-box { display: flex; flex-direction: column; gap: 4px; position: relative; }
        .notice-header { display: flex; justify-content: space-between; align-items: center; }
        .notice-label { font-size: 13px; font-weight: 800; color: #4338ca; }
        
        /* ì£¼ê°„ ì•ˆë‚´ì‚¬í•­ ì…ë ¥ ì‹œ ë…¸ë€ìƒ‰ ë°°ê²½ ë° ì§„í•œ ê¸€ì”¨ */
        .notice-input { border: 1px solid #cbd5e1; border-radius: 8px; padding: 10px; font-size: 14px; outline: none; transition: all 0.2s; min-height: 60px; resize: vertical; background-color: white; font-weight: normal; }
        .notice-input.has-content { background-color: #fef9c3 !important; font-weight: normal !important; border-color: #facc15; }
        .notice-input:focus { border-color: #6366f1; ring: 2px solid #e0e7ff; }
        
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 2000; align-items: center; justify-content: center; }
        .modal-content { background: white; padding: 24px; border-radius: 20px; width: 90%; max-width: 400px; box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1); }
    </style>
</head>
<body class="p-3">
    <div class="max-w-4xl mx-auto">
        <header class="flex justify-between items-center mb-6 bg-indigo-900 p-4 rounded-2xl text-white shadow-lg">
            <h1 class="font-black text-sm md:text-base">ğŸ« êµ¬ë¡€ì¤‘ í•™ì‚¬ë ¥</h1>
            <div class="flex gap-1 md:gap-2">
                <button onclick="app.setView('weekly')" class="text-[10px] md:text-xs bg-indigo-700 px-2 md:px-3 py-1.5 rounded-lg font-bold">ì£¼ê°„</button>
                <button onclick="app.setView('monthly')" class="text-[10px] md:text-xs bg-indigo-700 px-2 md:px-3 py-1.5 rounded-lg font-bold">ì›”ê°„</button>
                <button onclick="app.setView('yearly')" class="text-[10px] md:text-xs bg-indigo-700 px-2 md:px-3 py-1.5 rounded-lg font-bold">ì—°ê°„</button>
            </div>
        </header>

        <section class="bg-white p-4 rounded-2xl shadow-sm border mb-4 grid grid-cols-2 md:grid-cols-4 gap-2">
            <input type="date" id="inDate" class="border p-2 rounded-xl text-sm outline-none">
            <input type="text" id="inTitle" placeholder="í–‰ì‚¬ë‚´ìš©" class="border p-2 rounded-xl text-sm outline-none">
            <select id="inDept" class="border p-2 rounded-xl text-sm outline-none">
                <option>êµë¬´</option><option>ì—°êµ¬</option><option>í•™ìƒ</option><option>ì°½ì˜</option><option>í–‰ì •</option>
                <option>1í•™ë…„</option><option>2í•™ë…„</option><option>3í•™ë…„</option>
            </select>
            <button onclick="app.saveEvent()" class="bg-indigo-600 text-white rounded-xl font-bold py-2">ì €ì¥í•˜ê¸°</button>
        </section>

        <div class="flex justify-between items-center bg-white p-3 rounded-2xl border mb-4">
            <button onclick="app.move(-1)" class="text-indigo-600 font-bold px-4">â®</button>
            <h2 id="titleText" class="text-sm md:text-lg font-black text-slate-700">ë¡œë”© ì¤‘...</h2>
            <button onclick="app.move(1)" class="text-indigo-600 font-bold px-4">â¯</button>
        </div>

        <div id="viewPort"></div>
        
        <div id="noticePort" class="hidden">
            <div class="notice-section">
                <h3 class="font-black text-indigo-900 mb-4 flex items-center gap-2">ğŸ“¢ ì£¼ê°„ ì•ˆë‚´ì‚¬í•­</h3>
                <div class="notice-list">
                    <div class="notice-box"><div class="notice-header"><label class="notice-label">êµì¥</label><span class="del-x" onclick="app.clearNotice('êµì¥')">âœ•</span></div><textarea data-dept="êµì¥" class="notice-input" oninput="app.updateInputStyle(this); app.markAsEditing(this)" onchange="app.saveNotice(this)"></textarea></div>
                    <div class="notice-box"><div class="notice-header"><label class="notice-label">êµê°</label><span class="del-x" onclick="app.clearNotice('êµê°')">âœ•</span></div><textarea data-dept="êµê°" class="notice-input" oninput="app.updateInputStyle(this); app.markAsEditing(this)" onchange="app.saveNotice(this)"></textarea></div>
                    <div class="notice-box"><div class="notice-header"><label class="notice-label">í–‰ì •ì‹¤ì¥</label><span class="del-x" onclick="app.clearNotice('í–‰ì •ì‹¤ì¥')">âœ•</span></div><textarea data-dept="í–‰ì •ì‹¤" class="notice-input" oninput="app.updateInputStyle(this); app.markAsEditing(this)" onchange="app.saveNotice(this)"></textarea></div>
                    <div class="notice-box"><div class="notice-header"><label class="notice-label">êµë¬´ë¶€</label><span class="del-x" onclick="app.clearNotice('êµë¬´ë¶€')">âœ•</span></div><textarea data-dept="êµë¬´ë¶€" class="notice-input" oninput="app.updateInputStyle(this); app.markAsEditing(this)" onchange="app.saveNotice(this)"></textarea></div>
                    <div class="notice-box"><div class="notice-header"><label class="notice-label">ì—°êµ¬ë¶€</label><span class="del-x" onclick="app.clearNotice('ì—°êµ¬ë¶€')">âœ•</span></div><textarea data-dept="ì—°êµ¬ë¶€" class="notice-input" oninput="app.updateInputStyle(this); app.markAsEditing(this)" onchange="app.saveNotice(this)"></textarea></div>
                    <div class="notice-box"><div class="notice-header"><label class="notice-label">í•™ìƒë¶€</label><span class="del-x" onclick="app.clearNotice('í•™ìƒë¶€')">âœ•</span></div><textarea data-dept="í•™ìƒë¶€" class="notice-input" oninput="app.updateInputStyle(this); app.markAsEditing(this)" onchange="app.saveNotice(this)"></textarea></div>
                    <div class="notice-box"><div class="notice-header"><label class="notice-label">ì°½ì˜ì¸ì„±ë¶€</label><span class="del-x" onclick="app.clearNotice('ì°½ì˜ì¸ì„±ë¶€')">âœ•</span></div><textarea data-dept="ì°½ì˜ì¸ì„±ë¶€" class="notice-input" oninput="app.updateInputStyle(this); app.markAsEditing(this)" onchange="app.saveNotice(this)"></textarea></div>
                    <div class="notice-box"><div class="notice-header"><label class="notice-label">í•™ë…„ì‹¤</label><span class="del-x" onclick="app.clearNotice('í•™ë…„ì‹¤')">âœ•</span></div><textarea data-dept="í•™ë…„ì‹¤" class="notice-input" oninput="app.updateInputStyle(this); app.markAsEditing(this)" onchange="app.saveNotice(this)"></textarea></div>
                </div>
            </div>
        </div>

        <footer class="text-center py-8 text-slate-400 text-[10px]">
            Â©  Developed by Choi Gwang-cheol of Gurye Middle School in 2026. All rights reserved.
        </footer>
    </div>

    <div id="detailModal" class="modal" onclick="app.closeModal()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <h3 id="modalDate" class="font-black text-indigo-900 mb-2"></h3>
            <div id="modalContent" class="space-y-2 max-h-60 overflow-y-auto mb-4"></div>
            <button onclick="app.closeModal()" class="w-full bg-indigo-600 text-white font-bold py-2 rounded-xl">ë‹«ê¸°</button>
        </div>
    </div>

    <div id="syncIndicator" class="sync-indicator">â— ë™ê¸°í™” ì™„ë£Œ</div>

    <script>
        const app = {
            API_URL: 'https://script.google.com/macros/s/AKfycbwRtXEToXLJF3Vm3k2jpp76K478Mt6OeADDDCTmz7HoIYAzFNIc1yvC17H4hfYN3S2i/exec',
            events: [],
            currentDate: new Date(),
            viewMode: 'weekly',
            isSyncing: false,
            isEditing: false,
            days: ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '],
            
            holidays: [
                '2026-01-01:ì‹ ì •', '2026-02-16:ì„¤ë‚ ì—°íœ´', '2026-02-17:ì„¤ë‚ ', '2026-02-18:ì„¤ë‚ ì—°íœ´',
                '2026-03-01:ì‚¼ì¼ì ˆ', '2026-03-02:ëŒ€ì²´ê³µíœ´ì¼', '2026-05-05:ì–´ë¦°ì´ë‚ ', '2026-05-24:ë¶€ì²˜ë‹˜ì˜¤ì‹ ë‚ ', 
                '2026-05-25:ëŒ€ì²´ê³µíœ´ì¼', '2026-06-06:í˜„ì¶©ì¼', '2026-08-15:ê´‘ë³µì ˆ', '2026-08-17:ëŒ€ì²´ê³µíœ´ì¼',
                '2026-09-24:ì¶”ì„ì—°íœ´', '2026-09-25:ì¶”ì„', '2026-09-26:ì¶”ì„ì—°íœ´', '2026-10-03:ê°œì²œì ˆ', 
                '2026-10-05:ëŒ€ì²´ê³µíœ´ì¼', '2026-10-09:í•œê¸€ë‚ ', '2026-12-25:í¬ë¦¬ìŠ¤ë§ˆìŠ¤'
            ],
            
            getHoliday(dateStr) {
                const found = this.holidays.find(h => h.startsWith(dateStr));
                return found ? found.split(':')[1] : null;
            },

            // â­ 'ì¬ëŸ‰íœ´ì—…ì¼', 'íœ´ì—…ì¼', 'íœ´ë¬´ì¼' ì—¬ë¶€ í™•ì¸
            isSpecialHoliday(dateStr) {
                return this.events.some(e => e.date === dateStr && (e.title.includes('ì¬ëŸ‰íœ´ì—…ì¼') || e.title.includes('íœ´ì—…ì¼') || e.title.includes('íœ´ë¬´ì¼')));
            },
            
            setSyncStatus(status) {
                const indicator = document.getElementById('syncIndicator');
                if (status === 'syncing') {
                    indicator.className = 'sync-indicator syncing';
                    indicator.textContent = 'â— ë™ê¸°í™” ì¤‘...';
                } else if (status === 'success') {
                    indicator.className = 'sync-indicator';
                    indicator.textContent = 'â— ë™ê¸°í™” ì™„ë£Œ';
                } else if (status === 'error') {
                    indicator.className = 'sync-indicator';
                    indicator.style.background = '#ef4444';
                    indicator.textContent = 'â— ì˜¤ë¥˜ ë°œìƒ';
                }
            },
            
            async loadFromServer() {
                if (this.isSyncing) return;
                if (this.API_URL === 'YOUR_GOOGLE_APPS_SCRIPT_URL_HERE') {
                    const data = localStorage.getItem('gurye_events');
                    this.events = data ? JSON.parse(data) : [];
                    this.render();
                    return;
                }
                try {
                    this.isSyncing = true;
                    this.setSyncStatus('syncing');
                    const response = await fetch(this.API_URL + '?t=' + Date.now());
                    const data = await response.json();
                    this.events = data.map(item => {
                        let dateStr = item.date;
                        if (typeof dateStr === 'string' && dateStr.includes('T')) dateStr = dateStr.split('T')[0];
                        else if (typeof dateStr === 'string') dateStr = dateStr.substring(0, 10);
                        return { id: String(item.id), date: dateStr, title: item.title, dapt: item.dapt };
                    });
                    this.setSyncStatus('success');
                    this.render();
                } catch (error) {
                    console.error('ë¡œë“œ ì˜¤ë¥˜:', error);
                    this.setSyncStatus('error');
                } finally {
                    this.isSyncing = false;
                }
            },
            
            async saveToServer(action, data) {
                if (this.API_URL === 'YOUR_GOOGLE_APPS_SCRIPT_URL_HERE') {
                    localStorage.setItem('gurye_events', JSON.stringify(this.events));
                    return;
                }
                try {
                    this.setSyncStatus('syncing');
                    const response = await fetch(this.API_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'text/plain' },
                        body: JSON.stringify({ action, ...data })
                    });
                    const result = await response.json();
                    if (result.success) this.setSyncStatus('success');
                    else throw new Error(result.error);
                } catch (error) {
                    console.error('ì €ì¥ ì˜¤ë¥˜:', error);
                    this.setSyncStatus('error');
                }
            },

            markAsEditing(input) { this.isEditing = true; },
            
            updateInputStyle(input) {
                if (input.value.trim() !== "") input.classList.add('has-content');
                else input.classList.remove('has-content');
            },

            async saveNotice(input) {
                this.isEditing = false;
                const dept = input.dataset.dept;
                const content = input.value.trim();
                const monday = this.getMonday(this.currentDate);
                const dateStr = this.formatDate(monday);
                const noticeId = `notice_${dateStr}_${dept}`;
                
                const existingIndex = this.events.findIndex(e => e.id === noticeId);
                if (content === "") {
                    if (existingIndex !== -1) {
                        this.events.splice(existingIndex, 1);
                        await this.saveToServer('delete', { id: noticeId });
                    }
                } else {
                    const newNotice = { id: noticeId, date: dateStr, title: content, dapt: dept };
                    if (existingIndex !== -1) this.events[existingIndex] = newNotice;
                    else this.events.push(newNotice);
                    await this.saveToServer('add', newNotice);
                }
                this.render();
            },

            async clearNotice(dept) {
                if (!confirm(`${dept} ì•ˆë‚´ì‚¬í•­ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
                const monday = this.getMonday(this.currentDate);
                const dateStr = this.formatDate(monday);
                const noticeId = `notice_${dateStr}_${dept}`;
                this.events = this.events.filter(e => e.id !== noticeId);
                const input = document.querySelector(`textarea[data-dept="${dept}"]`);
                if (input) { input.value = ""; this.updateInputStyle(input); }
                await this.saveToServer('delete', { id: noticeId });
                this.render();
            },
            
            getMonday(d) {
                const date = new Date(d);
                const day = date.getDay();
                const diff = date.getDate() - day + (day === 0 ? -6 : 1);
                return new Date(date.setDate(diff));
            },
            
            formatDate(date) {
                const year = date.getFullYear();
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const day = String(date.getDate()).padStart(2, '0');
                return `${year}-${month}-${day}`;
            },

            async saveEvent() {
                const dateInput = document.getElementById('inDate').value;
                const title = document.getElementById('inTitle').value;
                const dapt = document.getElementById('inDept').value;
                if (!dateInput || !title) { alert('ë‚ ì§œì™€ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”.'); return; }
                const newEvent = { id: Date.now().toString(), date: dateInput, title: title, dapt: dapt };
                this.events.push(newEvent);
                this.render();
                document.getElementById('inDate').value = '';
                document.getElementById('inTitle').value = '';
                await this.saveToServer('add', newEvent);
            },
            
            async deleteEvent(id) {
                if (!confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
                this.events = this.events.filter(e => e.id !== id);
                this.render();
                await this.saveToServer('delete', { id });
                this.closeModal();
            },

            showDetail(dateStr) {
                const modal = document.getElementById('detailModal');
                const modalDate = document.getElementById('modalDate');
                const modalContent = document.getElementById('modalContent');
                const holiday = this.getHoliday(dateStr);
                const d = new Date(dateStr);
                const dayOfWeek = this.days[d.getDay()];
                
                modalDate.textContent = `${dateStr}(${dayOfWeek})` + (holiday ? ` (${holiday})` : '');
                modalContent.innerHTML = "";
                
                const dayEvents = this.events.filter(e => e.date === dateStr && !e.id.startsWith('notice_'));
                if (dayEvents.length === 0) {
                    modalContent.innerHTML = "<div class='text-slate-400 text-sm'>ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤.</div>";
                } else {
                    dayEvents.forEach(e => {
                        modalContent.innerHTML += `<div class="bg-slate-50 p-3 rounded-lg flex justify-between items-center">
                            <div class="dept-${e.dapt}"><span class="font-bold">[${e.dapt}]</span> ${e.title}</div>
                            <span class="del-x text-lg" onclick="app.deleteEvent('${e.id}')">âœ•</span>
                        </div>`;
                    });
                }
                modal.style.display = 'flex';
            },

            closeModal() { document.getElementById('detailModal').style.display = 'none'; },
            
            move(direction) {
                if (this.viewMode === 'yearly') this.currentDate.setFullYear(this.currentDate.getFullYear() + direction);
                else if (this.viewMode === 'monthly') this.currentDate.setMonth(this.currentDate.getMonth() + direction);
                else this.currentDate.setDate(this.currentDate.getDate() + (direction * 7));
                this.render();
            },
            
            setView(mode) { this.viewMode = mode; this.render(); },
            
            renderYearly() {
                const year = this.currentDate.getFullYear();
                let html = '<div class="year-view">';
                for (let m = 0; m < 12; m++) {
                    html += `<div class="year-month"><div class="year-month-title">${year}ë…„ ${m + 1}ì›”</div><div class="mini-calendar">`;
                    this.days.forEach(w => html += `<div class="text-[9px] text-slate-400 font-bold text-center p-1">${w}</div>`);
                    const first = new Date(year, m, 1).getDay();
                    const last = new Date(year, m + 1, 0).getDate();
                    for (let i = 0; i < first; i++) html += '<div></div>';
                    for (let d = 1; d <= last; d++) {
                        const dateStr = `${year}-${String(m + 1).padStart(2, '0')}-${String(d).padStart(2, '0')}`;
                        const dayIdx = new Date(year, m, d).getDay();
                        const hasEvent = this.events.some(e => e.date === dateStr && !e.id.startsWith('notice_'));
                        const holiday = this.getHoliday(dateStr);
                        const isSpecial = this.isSpecialHoliday(dateStr);
                        const isWeekend = dayIdx === 0 || dayIdx === 6;
                        const colorClass = dayIdx === 0 || holiday ? 'text-sun' : (dayIdx === 6 ? 'text-sat' : 'text-slate-600');
                        const holidayClass = (holiday || isSpecial || isWeekend) ? 'holiday-bg' : '';
                        const cellClass = holiday || isWeekend ? 'weekend' : (hasEvent ? 'has-event' : '');
                        html += `<div class="mini-day ${cellClass} ${colorClass} ${holidayClass}" onclick="app.showDetail('${dateStr}')">${d}</div>`;
                    }
                    html += '</div></div>';
                }
                return html + '</div>';
            },
            
            renderMonthly() {
                const year = this.currentDate.getFullYear();
                const month = this.currentDate.getMonth();
                let html = '<div class="calendar-grid">';
                this.days.forEach(w => html += `<div class="bg-slate-50 p-2 text-center text-[10px] md:text-[11px] font-bold text-slate-400">${w}</div>`);
                const first = new Date(year, month, 1).getDay();
                const last = new Date(year, month + 1, 0).getDate();
                for (let i = 0; i < first; i++) html += '<div class="day-cell bg-slate-50/30"></div>';
                for (let d = 1; d <= last; d++) {
                    const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(d).padStart(2, '0')}`;
                    const dayIdx = new Date(year, month, d).getDay();
                    const holiday = this.getHoliday(dateStr);
                    const isSpecial = this.isSpecialHoliday(dateStr);
                    const isWeekend = dayIdx === 0 || dayIdx === 6;
                    const colorClass = dayIdx === 0 || holiday ? 'text-sun' : (dayIdx === 6 ? 'text-sat' : 'text-slate-400');
                    const holidayClass = (holiday || isSpecial || isWeekend) ? 'holiday-bg' : '';
                    html += `<div class="day-cell ${holidayClass}" onclick="app.showDetail('${dateStr}')">
                        <div class="text-[10px] md:text-[11px] font-black ${colorClass}">${d}</div>`;
                    if (holiday) html += `<div class="holiday-badge">${holiday}</div>`;
                    html += '<div class="mt-1">';
                    this.events.filter(e => e.date === dateStr && !e.id.startsWith('notice_')).forEach(e => {
                        // PCì—ì„œëŠ” ì „ì²´ ì œëª© í‘œì‹œ, ëª¨ë°”ì¼ì—ì„œëŠ” 3ê¸€ìë§Œ í‘œì‹œ
                        const isMobile = window.innerWidth < 768;
                        const displayTitle = isMobile ? e.title.substring(0, 3) : e.title;
                        html += `<div class="event-item dept-${e.dapt}"><span>${displayTitle}</span></div>`;
                    });
                    html += '</div></div>';
                }
                return html + '</div>';
            },
            
            renderWeekly() {
                const monday = this.getMonday(this.currentDate);
                const dateStr = this.formatDate(monday);
                if (!this.isEditing) {
                    document.querySelectorAll('.notice-input').forEach(input => {
                        const dept = input.dataset.dept;
                        const noticeId = `notice_${dateStr}_${dept}`;
                        const notice = this.events.find(e => e.id === noticeId);
                        input.value = notice ? notice.title : "";
                        this.updateInputStyle(input);
                    });
                }
                let html = '<div class="flex flex-col gap-2">';
                for (let i = 0; i < 7; i++) {
                    const d = new Date(monday);
                    d.setDate(monday.getDate() + i);
                    const dStr = this.formatDate(d);
                    const holiday = this.getHoliday(dStr);
                    const isSpecial = this.isSpecialHoliday(dStr);
                    const isWeekend = d.getDay() === 0 || d.getDay() === 6;
                    const holidayClass = (holiday || isSpecial || isWeekend) ? 'holiday-bg' : '';
                    const dayOfWeek = this.days[d.getDay()];
                    const colorClass = d.getDay() === 0 || holiday ? 'text-sun' : (d.getDay() === 6 ? 'text-sat' : 'text-indigo-900');
                    
                    html += `<div class="week-item ${holidayClass} p-4 rounded-xl border flex items-center shadow-sm" onclick="app.showDetail('${dStr}')">
                        <div class="w-16 md:w-24 font-black ${colorClass} border-r mr-4">${d.getDate()}ì¼(${dayOfWeek})`;
                    if (holiday) html += `<div class="holiday-badge text-[9px]">${holiday}</div>`;
                    html += '</div><div class="flex-1">';
                    this.events.filter(e => e.date === dStr && !e.id.startsWith('notice_')).forEach(e => {
                        html += `<div class="event-item mb-1 p-2 dept-${e.dapt}" onclick="event.stopPropagation()">
                            <span>${e.title} (${e.dapt})</span>
                            <span class="del-x" onclick="app.deleteEvent('${e.id}')">âœ•</span>
                        </div>`;
                    });
                    html += '</div></div>';
                }
                return html + '</div>';
            },
            
            render() {
                const viewPort = document.getElementById('viewPort');
                const titleText = document.getElementById('titleText');
                const noticePort = document.getElementById('noticePort');
                const year = this.currentDate.getFullYear();
                const month = this.currentDate.getMonth() + 1;
                if (this.viewMode === 'yearly') {
                    titleText.textContent = `${year}ë…„ ì „ì²´ í•™ì‚¬ë ¥`;
                    viewPort.innerHTML = this.renderYearly();
                    noticePort.classList.add('hidden');
                } else if (this.viewMode === 'monthly') {
                    titleText.textContent = `${year}ë…„ ${month}ì›”`;
                    viewPort.innerHTML = this.renderMonthly();
                    noticePort.classList.add('hidden');
                } else {
                    titleText.textContent = `${year}ë…„ ${month}ì›” ì£¼ê°„ê³„íš`;
                    viewPort.innerHTML = this.renderWeekly();
                    noticePort.classList.remove('hidden');
                }
            },
            
            async init() {
                await this.loadFromServer();
                this.render();
                setInterval(() => { if (!this.isEditing) this.loadFromServer(); }, 5000);
                window.addEventListener('resize', () => this.render()); // í™”ë©´ í¬ê¸° ë³€ê²½ ì‹œ ì¬ë Œë”ë§
            },

            async toggleHoliday(dateStr) {
                const existing = this.events.find(e => e.date === dateStr && e.title === 'íœ´ì—…ì¼');
                if (existing) { if (confirm('íœ´ì—…ì¼ì„ í•´ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) await this.deleteEvent(existing.id); }
                else { if (confirm('íœ´ì—…ì¼ë¡œ ì§€ì •í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    const newEvent = { id: Date.now().toString(), date: dateStr, title: 'íœ´ì—…ì¼', dapt: 'í•™ì‚¬' };
                    this.events.push(newEvent); this.render(); await this.saveToServer('add', newEvent);
                }}
            }
        };
        window.addEventListener('DOMContentLoaded', () => app.init());
    </script>
</body>
</html>


