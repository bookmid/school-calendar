<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>êµ¬ë¡€ì¤‘í•™êµ ì‹¤ì‹œê°„ í•™ì‚¬ë ¥</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Pretendard:wght@400;600;700&display=swap');
        body { font-family: 'Pretendard', sans-serif; background-color: #f8fafc; margin: 0; }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 1px; background-color: #e2e8f0; border-radius: 12px; overflow: hidden; border: 1px solid #e2e8f0; }
        .day-cell { min-height: 120px; background-color: white; padding: 10px; text-align: left; transition: 0.2s; cursor: pointer; }
        .day-cell:hover { filter: brightness(0.95); }
        /* ì—°í•œ ë¹¨ê°„ìƒ‰ ë°°ê²½ í´ë˜ìŠ¤ */
        .bg-holiday { background-color: #fff1f2 !important; } 
        .event-badge { font-size: 11px; padding: 4px 8px; margin-top: 4px; border-radius: 6px; background-color: #eef2ff; border-left: 4px solid #4f46e5; color: #3730a3; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .loading-bar { position: fixed; top: 0; left: 0; width: 100%; height: 4px; background: #4f46e5; display: none; z-index: 9999; animation: loading 1.5s infinite; }
        @keyframes loading { 0% { transform: translateX(-100%); } 100% { transform: translateX(100%); } }
        @media (max-width: 640px) { .day-cell { min-height: 80px; padding: 4px; } .event-badge { font-size: 9px; } }
    </style>
</head>
<body>
    <div id="loading" class="loading-bar"></div>
    <nav class="bg-indigo-800 text-white p-4 shadow-lg sticky top-0 z-50">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-xl font-bold flex items-center gap-2 cursor-pointer" onclick="location.reload()">ğŸ« êµ¬ë¡€ì¤‘í•™êµ ì‹¤ì‹œê°„ í•™ì‚¬ë ¥</h1>
            <div class="flex gap-2">
                <button onclick="setView('yearly')" class="px-3 py-1 bg-indigo-700 hover:bg-indigo-600 rounded-lg text-sm transition">1ë…„</button>
                <button onclick="setView('monthly')" class="px-3 py-1 bg-indigo-900 rounded-lg text-sm font-bold border border-indigo-400">ì›”ê°„</button>
                <button onclick="setView('weekly')" class="px-3 py-1 bg-indigo-700 hover:bg-indigo-600 rounded-lg text-sm transition">ì£¼ê°„</button>
            </div>
        </div>
    </nav>

    <main class="container mx-auto p-4 max-w-6xl">
        <section class="bg-white p-6 rounded-3xl shadow-sm mb-6 border border-gray-100 mt-4">
            <div class="flex flex-col md:flex-row justify-center items-end gap-4">
                <div class="flex-1 text-left">
                    <label class="text-xs font-bold text-gray-400 ml-1">ë‚ ì§œ</label>
                    <input type="date" id="dateIn" class="w-full border p-3 rounded-2xl outline-none focus:ring-2 focus:ring-indigo-400">
                </div>
                <div class="flex-[2] text-left">
                    <label class="text-xs font-bold text-gray-400 ml-1">í–‰ì‚¬ ë‚´ìš©</label>
                    <input type="text" id="titleIn" placeholder="ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”" class="w-full border p-3 rounded-2xl outline-none focus:ring-2 focus:ring-indigo-400">
                </div>
                <div class="flex-1 text-left">
                    <label class="text-xs font-bold text-gray-400 ml-1">ë‹´ë‹¹ ë¶€ì„œ</label>
                    <select id="deptIn" class="w-full border p-3 rounded-2xl outline-none focus:ring-2 focus:ring-indigo-400">
                        <option value="êµë¬´ë¶€">êµë¬´ë¶€</option><option value="ì—°êµ¬ë¶€">ì—°êµ¬ë¶€</option><option value="í•™ìƒë¶€">í•™ìƒë¶€</option>
                        <option value="ì°½ì˜ì¸ì„±ë¶€">ì°½ì˜ì¸ì„±ë¶€</option><option value="êµê°">êµê°</option><option value="êµì¥">êµì¥</option>
                    </select>
                </div>
                <button onclick="handleAdd()" class="w-full md:w-32 bg-indigo-600 text-white py-4 rounded-2xl font-bold hover:bg-indigo-700 shadow-lg active:scale-95 transition">ì¼ì • ì €ì¥</button>
            </div>
        </section>

        <div class="flex justify-center items-center gap-12 mb-8">
            <button onclick="shiftTime(-1)" class="text-indigo-300 hover:text-indigo-600 text-4xl font-bold transition">â®</button>
            <h2 id="mainTitle" class="text-3xl font-black text-gray-800">2026ë…„ 2ì›”</h2>
            <button onclick="shiftTime(1)" class="text-indigo-300 hover:text-indigo-600 text-4xl font-bold transition">â¯</button>
        </div>

        <div id="viewPort" class="bg-white p-2 md:p-4 rounded-[2rem] shadow-2xl border border-gray-50 min-h-[600px]"></div>
    </main>

    <script>
        const API_URL = 'https://script.google.com/macros/s/AKfycbx2A8FSDG45mqzBeJadQR9K7hWz3x11EcZqv80QR0SuE-R-ST210CIwgl7aVp21ezYq/exec'; 
        
        let events = [];
        let curDate = new Date(2026, 1, 1); // 2026ë…„ 2ì›” ê¸°ì¤€ ì‹œì‘
        let curView = 'monthly';
        
        // 2026ë…„ ëŒ€í•œë¯¼êµ­ ê³µíœ´ì¼ ëª©ë¡ (YYYY-MM-DD í˜•ì‹)
        const holidays2026 = [
            '2026-01-01', '2026-02-16', '2026-02-17', '2026-02-18', '2026-03-01', '2026-03-02', 
            '2026-05-05', '2026-05-24', '2026-06-06', '2026-08-15', '2026-09-24', '2026-09-25', 
            '2026-09-26', '2026-10-03', '2026-10-09', '2026-12-25'
        ];

        // ì‚¬ìš©ìê°€ ìˆ˜ë™ìœ¼ë¡œ ë³€ê²½í•œ ë°°ê²½ìƒ‰ ì €ì¥ (ì„ì‹œ ìœ ì§€ìš©)
        let manualHolidays = new Set();

        async function fetchEvents() {
            document.getElementById('loading').style.display = 'block';
            try {
                const res = await fetch(API_URL);
                events = await res.json();
                render();
            } catch(e) { console.error("ì—°ê²° ì˜¤ë¥˜"); }
            document.getElementById('loading').style.display = 'none';
        }

        function toggleManualHoliday(dateStr) {
            if (manualHolidays.has(dateStr)) manualHolidays.delete(dateStr);
            else manualHolidays.add(dateStr);
            render();
        }

        function setView(v) { curView = v; render(); }

        function shiftTime(n) {
            if(curView === 'monthly') curDate.setMonth(curDate.getMonth() + n);
            else if(curView === 'yearly') curDate.setFullYear(curDate.getFullYear() + n);
            render();
        }

        function render() {
            const port = document.getElementById('viewPort');
            const head = document.getElementById('mainTitle');
            const y = curDate.getFullYear(), m = curDate.getMonth();
            head.innerText = `${y}ë…„ ${m + 1}ì›”`;

            if(curView === 'monthly') {
                let html = '<div class="calendar-grid w-full">';
                ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '].forEach((d,i) => 
                    html += `<div class="bg-gray-50 p-3 font-bold text-sm ${i===0?'text-red-500':i===6?'text-blue-500':'text-gray-500'}">${d}</div>`
                );
                
                const first = new Date(y, m, 1).getDay(), last = new Date(y, m + 1, 0).getDate();
                for(let i=0; i<first; i++) html += '<div class="day-cell bg-gray-50/30"></div>';
                
                for(let d=1; d<=last; d++) {
                    const dateObj = new Date(y, m, d);
                    const ds = `${y}-${String(m+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
                    const isSat = dateObj.getDay() === 6;
                    const isSun = dateObj.getDay() === 0;
                    const isHoliday = holidays2026.includes(ds) || isSat || isSun || manualHolidays.has(ds);
                    
                    html += `<div class="day-cell ${isHoliday ? 'bg-holiday' : ''}" onclick="toggleManualHoliday('${ds}')">
                                <div class="text-xs font-bold ${isSun || holidays2026.includes(ds) ? 'text-red-500' : isSat ? 'text-blue-500' : 'text-gray-300'} mb-2">${d}</div>`;
                    events.filter(e => e.date === ds).forEach(e => 
                        html += `<div class="event-badge">[${e.dept}] ${e.title}</div>`
                    );
                    html += `</div>`;
                }
                port.innerHTML = html
