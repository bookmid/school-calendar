<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>êµ¬ë¡€ì¤‘í•™êµ ì‹¤ì‹œê°„ í•™ì‚¬ë ¥</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Pretendard:wght@400;600;700&display=swap');
        body { font-family: 'Pretendard', sans-serif; background-color: #f8fafc; margin: 0; }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 1px; background-color: #e2e8f0; border-radius: 12px; overflow: hidden; border: 1px solid #e2e8f0; }
        .day-cell { min-height: 120px; background-color: white; padding: 10px; text-align: left; }
        .event-badge { font-size: 11px; padding: 4px 8px; margin-top: 4px; border-radius: 6px; background-color: #eef2ff; border-left: 4px solid #4f46e5; color: #3730a3; font-weight: 600; cursor: pointer; }
        .loading-bar { position: fixed; top: 0; left: 0; width: 100%; height: 4px; background: #4f46e5; display: none; z-index: 9999; animation: loading 1.5s infinite; }
        @keyframes loading { 0% { transform: translateX(-100%); } 100% { transform: translateX(100%); } }
    </style>
</head>
<body>
    <div id="loading" class="loading-bar"></div>
    <nav class="bg-indigo-800 text-white p-4 shadow-lg sticky top-0 z-50">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-xl font-bold">ğŸ« êµ¬ë¡€ì¤‘í•™êµ ì‹¤ì‹œê°„ í•™ì‚¬ë ¥</h1>
            <div class="flex gap-4">
                <button onclick="fetchEvents()" class="text-sm bg-indigo-600 px-3 py-1 rounded hover:bg-indigo-500">ìƒˆë¡œê³ ì¹¨</button>
            </div>
        </div>
    </nav>

    <main class="container mx-auto p-4 max-w-6xl">
        <section class="bg-white p-6 rounded-3xl shadow-sm mb-6 border border-gray-100 mt-4">
            <div class="flex flex-col md:flex-row justify-center items-end gap-4">
                <div class="flex-1 text-left">
                    <label class="text-xs font-bold text-gray-400 ml-1">ë‚ ì§œ</label>
                    <input type="date" id="dateIn" class="w-full border p-3 rounded-2xl outline-none focus:ring-2 focus:ring-indigo-400">
                </div>
                <div class="flex-[2] text-left">
                    <label class="text-xs font-bold text-gray-400 ml-1">í–‰ì‚¬ ë‚´ìš©</label>
                    <input type="text" id="titleIn" placeholder="ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”" class="w-full border p-3 rounded-2xl outline-none focus:ring-2 focus:ring-indigo-400">
                </div>
                <div class="flex-1 text-left">
                    <label class="text-xs font-bold text-gray-400 ml-1">ë‹´ë‹¹ ë¶€ì„œ</label>
                    <select id="deptIn" class="w-full border p-3 rounded-2xl outline-none focus:ring-2 focus:ring-indigo-400">
                        <option value="êµë¬´ë¶€">êµë¬´ë¶€</option><option value="ì—°êµ¬ë¶€">ì—°êµ¬ë¶€</option><option value="í•™ìƒë¶€">í•™ìƒë¶€</option>
                        <option value="ì°½ì˜ì¸ì„±ë¶€">ì°½ì˜ì¸ì„±ë¶€</option><option value="êµê°">êµê°</option><option value="êµì¥">êµì¥</option>
                    </select>
                </div>
                <button onclick="handleAdd()" class="w-full md:w-32 bg-indigo-600 text-white py-4 rounded-2xl font-bold hover:bg-indigo-700 shadow-lg transition active:scale-95">ì¼ì • ì €ì¥</button>
            </div>
        </section>

        <div class="flex justify-center items-center gap-12 mb-8">
            <button onclick="shiftTime(-1)" class="text-indigo-300 hover:text-indigo-600 text-4xl font-bold transition">â®</button>
            <h2 id="mainTitle" class="text-3xl font-black text-gray-800">ì—°ê²° ëŒ€ê¸° ì¤‘...</h2>
            <button onclick="shiftTime(1)" class="text-indigo-300 hover:text-indigo-600 text-4xl font-bold transition">â¯</button>
        </div>

        <div id="viewPort" class="bg-white p-4 rounded-[2rem] shadow-2xl border border-gray-50 min-h-[600px] flex items-center justify-center">
            <div id="statusMsg" class="text-gray-400 text-lg">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</div>
        </div>
    </main>

    <script>
        // âš ï¸ ì„ ìƒë‹˜ì´ ë§ˆì§€ë§‰ìœ¼ë¡œ ìƒì„±í•œ 'ì›¹ ì•± URL'ì„ ì—¬ê¸°ì— ë„£ìœ¼ì„¸ìš”!
        const API_URL = 'https://script.google.com/macros/s/AKfycbx2A8FSDG45mqzBeJadQR9K7hWz3x11EcZqv80QR0SuE-R-ST210CIwgl7aVp21ezYq/exec'; 
        
        let events = [];
        let curDate = new Date();

        async function fetchEvents() {
            document.getElementById('loading').style.display = 'block';
            try {
                const res = await fetch(API_URL);
                if(!res.ok) throw new Error();
                events = await res.json();
                render();
            } catch(e) {
                document.getElementById('viewPort').innerHTML = `
                    <div class="text-center">
                        <p class="text-red-500 font-bold text-xl">âš ï¸ êµ¬ê¸€ ì„œë²„ ì—°ê²° ì‹¤íŒ¨</p>
                        <p class="text-gray-500 mt-2">êµ¬ê¸€ ìŠ¤í¬ë¦½íŠ¸ ë°°í¬ ì‹œ <b>'ì•¡ì„¸ìŠ¤ ê¶Œí•œ'</b>ì„ <br><b>'ëª¨ë“  ì‚¬ìš©ì(Anyone)'</b>ë¡œ ì„¤ì •í–ˆëŠ”ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.</p>
                    </div>`;
            }
            document.getElementById('loading').style.display = 'none';
        }

        async function handleAdd() {
            const date = document.getElementById('dateIn').value;
            const title = document.getElementById('titleIn').value;
            const dept = document.getElementById('deptIn').value;
            if(!date || !title) return alert("ë‚ ì§œì™€ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!");

            document.getElementById('loading').style.display = 'block';
            try {
                const res = await fetch(API_URL, { 
                    method: 'POST', 
                    body: JSON.stringify({ action: 'add', id: Date.now().toString(), date, title, dept }) 
                });
                document.getElementById('titleIn').value = '';
                document.getElementById('titleIn').focus();
                await fetchEvents();
            } catch(e) { alert("ì €ì¥ ì‹¤íŒ¨! ì„œë²„ ì„¤ì •ì„ í™•ì¸í•˜ì„¸ìš”."); }
            document.getElementById('loading').style.display = 'none';
        }

        function shiftTime(n) {
            curDate.setMonth(curDate.getMonth() + n);
            render();
        }

        function render() {
            const port = document.getElementById('viewPort');
            const head = document.getElementById('mainTitle');
            const y = curDate.getFullYear(), m = curDate.getMonth();
            head.innerText = `${y}ë…„ ${m + 1}ì›”`;
            
            let html = '<div class="calendar-grid w-full">';
            ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '].forEach((d,i) => 
                html += `<div class="bg-gray-50 p-3 font-bold text-sm ${i===0?'text-red-500':i===6?'text-blue-500':'text-gray-500'}">${d}</div>`
            );
            
            const first = new Date(y, m, 1).getDay(), last = new Date(y, m + 1, 0).getDate();
            for(let i=0; i<first; i++) html += '<div class="day-cell bg-gray-50/30"></div>';
            for(let d=1; d<=last; d++) {
                const ds = `${y}-${String(m+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
                html += `<div class="day-cell"><div class="text-xs font-bold text-gray-300 mb-2">${d}</div>`;
                events.filter(e => e.date === ds).forEach(e => 
                    html += `<div class="event-badge" onclick="if(confirm('ì‚­ì œí• ê¹Œìš”?')) deleteEv('${e.id}')">[${e.dept}] ${e.title}</div>`
                );
                html += `</div>`;
            }
            port.innerHTML = html + '</div>';
            port.className = "bg-white p-2 md:p-4 rounded-3xl shadow-xl border border-gray-100 min-h-[500px]";
        }

        async function deleteEv(id) {
            document.getElementById('loading').style.display = 'block';
            await fetch(API_URL, { method: 'POST', body: JSON.stringify({ action: 'delete', id: id.toString() }) });
            await fetchEvents();
        }

        window.onload = fetchEvents;
    </script>
</body>
</html>
