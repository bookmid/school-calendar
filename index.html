<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>êµ¬ë¡€ì¤‘í•™êµ í•™ì‚¬ë ¥</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Pretendard:wght@400;600;700&display=swap');
        body { font-family: 'Pretendard', sans-serif; text-align: center; margin: 0; padding: 0; }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); text-align: left; }
        .day-cell { min-height: 100px; border: 1px solid #e5e7eb; }
        input, select, button { text-align: center; }
        @media (max-width: 640px) {
            .day-cell { min-height: 70px; font-size: 0.7rem; }
            .mobile-hide { display: none; }
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <nav class="bg-blue-900 text-white p-4 shadow-lg sticky top-0 z-50">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-xl font-bold cursor-pointer" onclick="location.reload()">ğŸ« êµ¬ë¡€ì¤‘í•™êµ í•™ì‚¬ë ¥</h1>
            <div class="flex gap-1">
                <button onclick="changeView('yearly')" class="px-3 py-1.5 bg-blue-700 hover:bg-blue-800 rounded text-sm transition font-bold">1ë…„</button>
                <button onclick="changeView('monthly')" class="px-3 py-1.5 bg-blue-700 hover:bg-blue-800 rounded text-sm transition font-bold">ì›”ê°„</button>
                <button onclick="changeView('weekly')" class="px-3 py-1.5 bg-blue-700 hover:bg-blue-800 rounded text-sm transition font-bold">ì£¼ê°„</button>
            </div>
        </div>
    </nav>

    <main class="container mx-auto p-2 md:p-4 max-w-6xl">
        <section class="bg-white p-4 rounded-xl shadow-sm border mb-4">
            <h2 class="font-bold mb-4 text-blue-900">ğŸ“ í•™ì‚¬ ì¼ì • ë“±ë¡</h2>
            <div class="flex flex-col md:flex-row justify-center items-center gap-2">
                <input type="date" id="eventDate" class="w-full md:w-auto border p-2 rounded text-sm outline-none focus:ring-1 focus:ring-blue-500">
                <input type="text" id="eventTitle" placeholder="í–‰ì‚¬ ë‚´ìš© ì…ë ¥" class="w-full md:w-64 border p-2 rounded text-sm outline-none focus:ring-1 focus:ring-blue-500">
                <select id="eventDept" class="w-full md:w-auto border p-2 rounded text-sm outline-none focus:ring-1 focus:ring-blue-500">
                    <option value="">ë¶€ì„œ ì„ íƒ</option>
                    <option value="êµë¬´ë¶€">êµë¬´ë¶€</option>
                    <option value="ì—°êµ¬ë¶€">ì—°êµ¬ë¶€</option>
                    <option value="í•™ìƒë¶€">í•™ìƒë¶€</option>
                    <option value="ì°½ì˜ì¸ì„±ë¶€">ì°½ì˜ì¸ì„±ë¶€</option>
                    <option value="êµê°">êµê°</option>
                    <option value="êµì¥">êµì¥</option>
                    <option value="ê¸°íƒ€">ê¸°íƒ€</option>
                </select>
                <button onclick="addEvent()" class="w-full md:w-32 bg-blue-600 text-white p-2 rounded hover:bg-blue-700 font-bold text-sm transition">ì¼ì • ì €ì¥</button>
            </div>
            <p class="text-[10px] text-gray-400 mt-2">* ë¶€ì„œëŠ” í•œ ë²ˆ ì„ íƒí•˜ë©´ ë‹¤ë¥¸ ì¼ì • ì…ë ¥ ì‹œì—ë„ ìœ ì§€ë©ë‹ˆë‹¤.</p>
        </section>

        <div class="flex items-center justify-center gap-4 mb-4 bg-white py-3 rounded-lg shadow-sm border">
            <button onclick="moveTime(-1)" class="text-xl font-bold text-blue-600 px-4">â—€</button>
            <div id="viewTitle" class="text-base md:text-xl font-bold text-gray-800 text-center min-w-[200px]">ë¡œë”© ì¤‘...</div>
            <button onclick="moveTime(1)" class="text-xl font-bold text-blue-600 px-4">â–¶</button>
        </div>

        <div id="contentDisplay" class="bg-white p-2 md:p-4 rounded-xl shadow-md min-h-[400px]">
            <div id="renderTarget" class="w-full"></div>
        </div>
    </main>

    <script>
        // ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
        let events = [];
        try {
            events = JSON.parse(localStorage.getItem('gureMS_Events')) || [];
        } catch (e) {
            events = [];
        }

        let currentView = 'monthly';
        let viewDate = new Date();

        // 1. ì¼ì • ì¶”ê°€
        function addEvent() {
            const date = document.getElementById('eventDate').value;
            const title = document.getElementById('eventTitle').value;
            const dept = document.getElementById('eventDept').value;

            if(!date || !title || !dept) {
                alert("ë‚ ì§œ, ë‚´ìš©, ë¶€ì„œë¥¼ ëª¨ë‘ í™•ì¸í•´ì£¼ì„¸ìš”!");
                return;
            }

            events.push({ id: Date.now(), date, title, dept });
            localStorage.setItem('gureMS_Events', JSON.stringify(events));
            
            // ë‚´ìš©ë§Œ ë¹„ìš°ê³  ë¶€ì„œëŠ” ìœ ì§€
            document.getElementById('eventTitle').value = '';
            document.getElementById('eventTitle').focus();
            render();
        }

        // 2. ì¼ì • ì‚­ì œ
        function deleteEvent(id) {
            if(confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
                events = events.filter(e => e.id !== id);
                localStorage.setItem('gureMS_Events', JSON.stringify(events));
                render();
            }
        }

        // 3. ì‹œê°„ ì´ë™ ë¡œì§
        function moveTime(offset) {
            if (currentView === 'yearly') {
                viewDate.setFullYear(viewDate.getFullYear() + offset);
            } else if (currentView === 'monthly') {
                viewDate.setMonth(viewDate.getMonth() + offset);
            } else if (currentView === 'weekly') {
                viewDate.setDate(viewDate.getDate() + (offset * 7));
            }
            render();
        }

        function changeView(view) {
            currentView = view;
            render();
        }

        // 4. ì£¼ê°„ ë²”ìœ„ ê³„ì‚° (ì•ˆì „í•œ ë²„ì „)
        function getWeekRange(date) {
            let d = new Date(date);
            let day = d.getDay();
            // ì›”ìš”ì¼ë¡œ ë§ì¶”ê¸° (ì¼ìš”ì¼ì¸ ê²½ìš° íŠ¹ë³„ ì²˜ë¦¬)
            let diff = d.getDate() - day + (day === 0 ? -6 : 1);
            
            let monday = new Date(d.setDate(diff));
            let friday = new Date(new Date(monday).setDate(monday.getDate() + 4));

            const fmt = (t) => `${t.getMonth() + 1}.${t.getDate()}.(${['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '][t.getDay()]})`;
            
            return {
                text: `${fmt(monday)} - ${fmt(friday)}`,
                start: monday.toISOString().split('T')[0],
                end: friday.toISOString().split('T')[0]
            };
        }

        // 5. í•µì‹¬ ë Œë”ë§ í•¨ìˆ˜
        function render() {
            const target = document.getElementById('renderTarget');
            const title = document.getElementById('viewTitle');
            if(!target) return;
            target.innerHTML = '';

            if (currentView === 'yearly') {
                title.innerText = `${viewDate.getFullYear()}í•™ë…„ë„ í•™ì‚¬ë ¥`;
                renderYearly(target);
            } else if (currentView === 'monthly') {
                title.innerText = `${viewDate.getFullYear()}ë…„ ${viewDate.getMonth() + 1}ì›” ê³„íš`;
                renderMonthly(target);
            } else if (currentView === 'weekly') {
                const range = getWeekRange(viewDate);
                title.innerText = `ì£¼ê°„ê³„íš (${range.text})`;
                renderWeekly(target, range.start, range.end);
            }
        }

        function renderMonthly(target) {
            let html = `<div class="calendar-grid bg-gray-200 gap-px border">`;
            const days = ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '];
            days.forEach((d, i) => {
                const color = i === 0 ? 'text-red-500' : (i === 6 ? 'text-blue-500' : '');
                html += `<div class="bg-gray-100 p-2 text-center font-bold text-xs ${color}">${d}</div>`;
            });

            const firstDay = new Date(viewDate.getFullYear(), viewDate.getMonth(), 1).getDay();
            const lastDate = new Date(viewDate.getFullYear(), viewDate.getMonth() + 1, 0).getDate();

            for(let i=0; i<firstDay; i++) html += `<div class="day-cell bg-gray-50"></div>`;
            for(let d=1; d<=lastDate; d++) {
                const dateStr = `${viewDate.getFullYear()}-${String(viewDate.getMonth()+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
                const dayEvents = events.filter(e => e.date === dateStr);
                html += `
                    <div class="day-cell bg-white p-1 overflow-y-auto text-left">
                        <div class="font-bold text-xs mb-1">${d}</div>
                        ${dayEvents.map(e => `
                            <div class="text-[9px] bg-blue-50 mb-0.5 p-0.5 rounded border-l-2 border-blue-400 truncate">
                                <span class="text-blue-700 font-bold md:inline hidden">[${e.dept
