<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>êµ¬ë¡€ì¤‘í•™êµ í•™ì‚¬ë ¥</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Pretendard:wght@400;600;700&display=swap');
        body { font-family: 'Pretendard', sans-serif; text-align: center; background-color: #f3f4f6; margin: 0; }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 1px; background-color: #e5e7eb; border: 1px solid #e5e7eb; }
        .day-cell { min-height: 120px; background-color: white; padding: 8px; text-align: left; }
        .event-badge { font-size: 10px; padding: 2px 4px; margin-top: 2px; border-radius: 4px; background-color: #eff6ff; border-left: 3px solid #3b82f6; color: #1e40af; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        input, select, button { text-align: center; }
        @media (max-width: 640px) { .day-cell { min-height: 80px; } .event-badge { font-size: 8px; } }
    </style>
</head>
<body>

    <nav class="bg-indigo-900 text-white p-4 shadow-lg sticky top-0 z-50">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-xl font-bold cursor-pointer" onclick="location.reload()">ğŸ« êµ¬ë¡€ì¤‘í•™êµ í•™ì‚¬ë ¥</h1>
            <div class="flex gap-2">
                <button onclick="setView('yearly')" class="px-3 py-1 bg-indigo-700 hover:bg-indigo-800 rounded font-bold transition">1ë…„</button>
                <button onclick="setView('monthly')" class="px-3 py-1 bg-indigo-700 hover:bg-indigo-800 rounded font-bold transition">ì›”ê°„</button>
                <button onclick="setView('weekly')" class="px-3 py-1 bg-indigo-700 hover:bg-indigo-800 rounded font-bold transition">ì£¼ê°„</button>
            </div>
        </div>
    </nav>

    <main class="container mx-auto p-4 max-w-6xl">
        <section class="bg-white p-6 rounded-2xl shadow-sm mb-6 border border-gray-200">
            <div class="flex flex-col md:flex-row justify-center items-center gap-3">
                <div class="flex flex-col items-start w-full md:w-auto">
                    <label class="text-xs font-bold text-gray-500 mb-1 ml-1">ë‚ ì§œ</label>
                    <input type="date" id="dateIn" class="border p-2 rounded-lg w-full outline-none focus:ring-2 focus:ring-indigo-500">
                </div>
                <div class="flex flex-col items-start w-full md:w-64">
                    <label class="text-xs font-bold text-gray-500 mb-1 ml-1">í–‰ì‚¬ ë‚´ìš©</label>
                    <input type="text" id="titleIn" placeholder="ë‚´ìš© ì…ë ¥" class="border p-2 rounded-lg w-full outline-none focus:ring-2 focus:ring-indigo-500">
                </div>
                <div class="flex flex-col items-start w-full md:w-auto">
                    <label class="text-xs font-bold text-gray-500 mb-1 ml-1">ê´€ë ¨ ë¶€ì„œ</label>
                    <select id="deptIn" class="border p-2 rounded-lg w-full outline-none focus:ring-2 focus:ring-indigo-500">
                        <option value="êµë¬´ë¶€">êµë¬´ë¶€</option>
                        <option value="ì—°êµ¬ë¶€">ì—°êµ¬ë¶€</option>
                        <option value="í•™ìƒë¶€">í•™ìƒë¶€</option>
                        <option value="ì°½ì˜ì¸ì„±ë¶€">ì°½ì˜ì¸ì„±ë¶€</option>
                        <option value="êµê°">êµê°</option>
                        <option value="êµì¥">êµì¥</option>
                        <option value="ê¸°íƒ€">ê¸°íƒ€</option>
                    </select>
                </div>
                <button onclick="handleAdd()" class="w-full md:w-24 mt-5 bg-indigo-600 text-white p-2 rounded-lg font-bold hover:bg-indigo-700 shadow-md transition active:scale-95">ì €ì¥</button>
            </div>
        </section>

        <div class="flex justify-center items-center gap-10 mb-6">
            <button onclick="shiftTime(-1)" class="text-indigo-600 hover:scale-125 transition text-2xl font-bold">â—€</button>
            <h2 id="mainTitle" class="text-2xl font-extrabold text-gray-800 min-w-[250px]">ë‹¬ë ¥ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</h2>
            <button onclick="shiftTime(1)" class="text-indigo-600 hover:scale-125 transition text-2xl font-bold">â–¶</button>
        </div>

        <div id="viewPort" class="bg-white p-4 rounded-2xl shadow-xl min-h-[500px]"></div>
    </main>

    <script>
        // ë°ì´í„° ì €ì¥ì†Œ (ì¶©ëŒ ë°©ì§€ë¥¼ ìœ„í•œ ìƒˆ í‚¤ ì´ë¦„)
        const STORAGE_KEY = 'GURE_SCHOOL_APP_V1';
        let events = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
        let curDate = new Date();
        let curView = 'monthly';

        // ì¼ì • ì¶”ê°€ (ë¶€ì„œ/ë‚ ì§œ ìœ ì§€)
        function handleAdd() {
            const date = document.getElementById('dateIn').value;
            const title = document.getElementById('titleIn').value;
            const dept = document.getElementById('deptIn').value;

            if(!date || !title) return alert("ë‚ ì§œì™€ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!");

            events.push({ id: Date.now(), date, title, dept });
            localStorage.setItem(STORAGE_KEY, JSON.stringify(events));
            
            document.getElementById('titleIn').value = '';
            document.getElementById('titleIn').focus();
            render();
        }

        function deleteEv(id) {
            if(!confirm("ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
            events = events.filter(e => e.id !== id);
            localStorage.setItem(STORAGE_KEY, JSON.stringify(events));
            render();
        }

        function setView(v) { curView = v; render(); }
        function shiftTime(n) {
            if(curView === 'yearly') curDate.setFullYear(curDate.getFullYear() + n);
            else if(curView === 'monthly') curDate.setMonth(curDate.getMonth() + n);
            else if(curView === 'weekly') curDate.setDate(curDate.getDate() + (n * 7));
            render();
        }

        function render() {
            const port = document.getElementById('viewPort');
            const head = document.getElementById('mainTitle');
            if(!port) return;
            port.innerHTML = '';

            try {
                if(curView === 'monthly') renderMonthly(port, head);
                else if(curView === 'weekly') renderWeekly(port, head);
                else if(curView === 'yearly') renderYearly(port, head);
            } catch(e) {
                port.innerHTML = '<div class="p-20 text-red-500">í™”ë©´ì„ ê·¸ë¦¬ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ìƒˆë¡œê³ ì¹¨ í•´ì£¼ì„¸ìš”.</div>';
            }
        }

        function renderMonthly(port, head) {
            const y = curDate.getFullYear(), m = curDate.getMonth();
            head.innerText = `${y}ë…„ ${m + 1}ì›” ê³„íš`;
            
            let html = '<div class="calendar-grid">';
            ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '].forEach(d => html += `<div class="bg-gray-100 p-2 font-bold text-xs">${d}</div>`);
            
            const first = new Date(y, m, 1).getDay();
            const last = new Date(y, m + 1, 0).getDate();
            
            for(let i=0; i<first; i++) html += '<div class="day-cell bg-gray-50/50"></div>';
            for(let d=1; d<=last; d++) {
                const ds = `${y}-${String(m+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
                const match = events.filter(e => e.date === ds);
                html += `<div class="day-cell"><div class="text-xs font-bold text-gray-400 mb-1">${d}</div>`;
                match.forEach(e => html += `<div class="event-badge" title="${e.title}">[${e.dept}] ${e.title}</div>`);
                html += `</div>`;
            }
            port.innerHTML = html + '</div>';
        }

        function renderWeekly(port, head) {
            const d = new Date(curDate);
            const day = d.getDay();
            const diff = d.getDate() - day + (day === 0 ? -6 : 1);
            const mon = new Date(d.setDate(diff));
            const fri = new Date(new Date(mon).getTime() + (4 * 24 * 60 * 60 * 1000));
            
            const f = (t) => `${t.getMonth()+1}/${t.getDate()}(${['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '][t.getDay()]})`;
            head.innerText = `${f(mon)} - ${f(fri)}`;

            const sStr = mon.toISOString().split('T')[0];
            const eStr = fri.toISOString().split('T')[0];
            const list = events.filter(e => e.date >= sStr && e.date <= eStr).sort((a,b)=>a.date.localeCompare(b.date));

            let html = '<table class="w-full text-sm"><thead><tr class="bg-indigo-50 border-b-2 border-indigo-100"><th class="p-4">ë‚ ì§œ</th><th class="p-4">ë¶€ì„œ</th><th class="p-4 text-left">í–‰ì‚¬ ë‚´ìš©</th><th class="p-4">ì‚­ì œ</th></tr></thead><tbody>';
            list.forEach(e => {
                const dayLab = ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '][new Date(e.date).getDay()];
                html += `<tr class="border-b hover:bg-gray-50"><td class="p-4">${e.date.slice(5)} (${dayLab})</td><td class="p-4"><span class="bg-indigo-100 text-indigo-700 px-2 py-1 rounded-md font-bold text-xs">${e.dept}</span></td><td class="p-4 text-left font-bold text-gray-700">${e.title}</td><td class="p-4"><button onclick="deleteEv(${e.id})" class="text-red-300 hover:text-red-600 transition">âœ•</button></td></tr>`;
            });
            port.innerHTML = html + (list.length ? '' : '<tr><td colspan="4" class="p-20 text-gray-400">ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>') + '</tbody></table>';
        }

        function renderYearly(port, head) {
            const y = curDate.getFullYear();
            head.innerText = `${y}í•™ë…„ë„ ì „ì²´ í•™ì‚¬ë ¥`;
            let html = '<div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-4 text-left">';
            for(let m=0; m<12; m++) {
                const mList = events.filter(e => { const d = new Date(e.date); return d.getFullYear() === y && d.getMonth() === m; }).sort((a,b)=>a.date.localeCompare(b.date));
                html += `<div class="border p-4 rounded-xl bg-white shadow-sm"><h3 class="font-bold border-b pb-2 mb-2 text-indigo-800">${m+1}ì›”</h3><ul class="space-y-1 text-xs text-gray-600">`;
                mList.forEach(e => html += `<li><span class="font-bold text-gray-400">${e.date.split('-')[2]}ì¼:</span> ${e.title}</li>`);
                html += (mList.length ? '' : '<li class="text-gray-300 font-light italic">ê³„íš ì—†ìŒ</li>') + '</ul></div>';
            }
            port.innerHTML = html + '</div>';
        }

        // ì´ˆê¸°í™”
        window.onload = render;
    </script>
</body>
</html>
