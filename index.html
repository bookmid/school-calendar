<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>êµ¬ë¡€ì¤‘ í•™ì‚¬ë ¥</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="p-4 bg-gray-50">
<div class="max-w-4xl mx-auto">
<header class="bg-indigo-900 text-white p-4 rounded-xl mb-4 flex justify-between items-center">
<h1 class="text-xl font-bold">ğŸ« êµ¬ë¡€ì¤‘ í•™ì‚¬ë ¥</h1>
<div class="flex gap-2">
<button id="btnLogin" class="bg-indigo-700 px-3 py-1 rounded text-sm">ğŸ”</button>
<button id="btnWeekly" class="bg-indigo-700 px-3 py-1 rounded text-sm">ì£¼ê°„</button>
<button id="btnMonthly" class="bg-indigo-700 px-3 py-1 rounded text-sm">ì›”ê°„</button>
</div>
</div>
</header>

<div class="bg-white p-4 rounded-xl mb-4 grid grid-cols-4 gap-2">
<input type="date" id="inDate" class="border p-2 rounded">
<input type="text" id="inTitle" placeholder="í–‰ì‚¬ë‚´ìš©" class="border p-2 rounded">
<select id="inDept" class="border p-2 rounded">
<option>êµë¬´</option>
<option>ì—°êµ¬</option>
<option>í•™ìƒ</option>
</select>
<button id="btnSave" class="bg-indigo-600 text-white rounded font-bold">ì €ì¥</button>
</div>

<div class="bg-white p-3 rounded-xl mb-4 flex justify-between items-center">
<button id="btnPrev" class="text-indigo-600 font-bold">â®</button>
<h2 id="titleText" class="font-bold">2026ë…„ 2ì›” ì£¼ê°„</h2>
<button id="btnNext" class="text-indigo-600 font-bold">â¯</button>
</div>

<div id="viewPort" class="bg-white p-8 rounded-xl text-center">
<p class="text-gray-400">ë°ì´í„° ë¡œë“œ ì¤‘...</p>
</div>

<div id="sync" class="fixed bottom-4 right-4 bg-indigo-600 text-white px-4 py-2 rounded-full text-sm">â— ì´ˆê¸°í™”</div>
</div>

<div id="modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); align-items:center; justify-content:center;">
<div style="background:white; padding:24px; border-radius:16px; max-width:400px; width:90%;">
<h3 style="font-size:18px; font-weight:bold; margin-bottom:16px;">ğŸ” ê´€ë¦¬ì ë¡œê·¸ì¸</h3>
<input type="text" id="adminId" value="admin" style="width:100%; padding:12px; border:2px solid #e5e7eb; border-radius:8px; margin-bottom:12px;">
<input type="password" id="adminPw" style="width:100%; padding:12px; border:2px solid #e5e7eb; border-radius:8px; margin-bottom:12px;">
<button id="btnDoLogin" style="width:100%; padding:12px; background:#4f46e5; color:white; border:none; border-radius:8px; font-weight:bold; cursor:pointer;">ë¡œê·¸ì¸</button>
</div>
</div>

<script>
var API = "'''

html += api_url  # API URL ì§ì ‘ ì‚½ì…

html += '''";
var events = [];
var currentDate = new Date();
var loading = false;

function loadData() {
    if (loading) return;
    loading = true;
    document.getElementById("sync").textContent = "â— ë¡œë”©...";
    
    console.log("ğŸ“¥ ë¡œë”© ì‹œì‘");
    console.log("ğŸ“ API:", API);
    
    fetch(API + "?action=load&t=" + Date.now())
        .then(function(r) { 
            console.log("ğŸ“¥ ì‘ë‹µ:", r.status);
            if (!r.ok) throw new Error("HTTP " + r.status);
            return r.json(); 
        })
        .then(function(data) {
            console.log("âœ… ë°ì´í„°:", data);
            events = data.events || [];
            document.getElementById("sync").textContent = "â— ì™„ë£Œ";
            renderView();
        })
        .catch(function(e) {
            console.error("âŒ ì—ëŸ¬:", e);
            document.getElementById("sync").textContent = "â— ì˜¤ë¥˜";
            document.getElementById("viewPort").innerHTML = '<p class="text-red-500">ì—ëŸ¬: ' + e.message + '</p>';
        })
        .finally(function() {
            loading = false;
        });
}

function renderView() {
    var html = '<div class="space-y-2">';
    html += '<h3 class="font-bold mb-4">ì£¼ê°„ ì¼ì •</h3>';
    
    if (events.length === 0) {
        html += '<p class="text-gray-400">ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
    } else {
        for (var i = 0; i < events.length; i++) {
            html += '<div class="bg-gray-50 p-3 rounded-lg border-l-4 border-indigo-600">';
            html += '<div class="font-bold">' + events[i].title + '</div>';
            html += '<div class="text-sm text-gray-500">' + events[i].date + ' | ' + events[i].dapt + '</div>';
            html += '</div>';
        }
    }
    html += '</div>';
    
    document.getElementById("viewPort").innerHTML = html;
}

document.getElementById("btnLogin").addEventListener("click", function() {
    document.getElementById("modal").style.display = "flex";
});

document.getElementById("btnDoLogin").addEventListener("click", function() {
    var id = document.getElementById("adminId").value;
    var pw = document.getElementById("adminPw").value;
    if (id === "admin" && pw === "1234") {
        alert("ë¡œê·¸ì¸ ì„±ê³µ!");
        document.getElementById("modal").style.display = "none";
    } else {
        alert("ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.");
    }
});

document.getElementById("btnSave").addEventListener("click", function() {
    var d = document.getElementById("inDate").value;
    var t = document.getElementById("inTitle").value;
    var dept = document.getElementById("inDept").value;
    
    if (!d || !t) {
        alert("ë‚ ì§œì™€ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”.");
        return;
    }
    
    var newEvent = {
        id: Date.now().toString(),
        date: d,
        title: t,
        dapt: dept
    };
    
    events.push(newEvent);
    renderView();
    
    fetch(API, {
        method: "POST",
        body: JSON.stringify({
            action: "addEvent",
            id: newEvent.id,
            date: newEvent.date,
            title: newEvent.title,
            dapt: newEvent.dapt
        })
    }).then(function() {
        console.log("ğŸ’¾ ì €ì¥ ì™„ë£Œ");
        setTimeout(loadData, 1000);
    });
    
    document.getElementById("inDate").value = "";
    document.getElementById("inTitle").value = "";
});

console.log("ğŸš€ ì‹œìŠ¤í…œ ì‹œì‘");
console.log("ğŸ“ API URL:", API);
loadData();
setInterval(function() { if (!loading) loadData(); }, 15000);
</script>
</body>
</html>
