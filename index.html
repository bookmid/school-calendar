<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>êµ¬ë¡€ì¤‘ ì‹¤ì‹œê°„ í•™ì‚¬ë ¥</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Pretendard:wght@400;700;900&display=swap');
        body {{ font-family: 'Pretendard', sans-serif; background-color: #f8fafc; }}
        .calendar-grid {{ display: grid; grid-template-columns: repeat(7, 1fr); gap: 1px; background-color: #e2e8f0; border: 1px solid #e2e8f0; border-radius: 12px; overflow: hidden; }}
        .day-cell {{ min-height: 110px; background-color: white; padding: 6px; position: relative; cursor: pointer; overflow: hidden; }}
        .day-cell:hover {{ background-color: #f8fafc; }}
        .day-cell.weekend-cell {{ background-color: #fef2f2; }}
        .day-cell.admin-mode {{ cursor: crosshair; }}
        .event-item {{ font-size: 11px; padding: 3px 6px; margin-top: 3px; border-radius: 4px; background-color: #f1f5f9; border-left: 3px solid #94a3b8; color: #1e293b; font-weight: 700; overflow: hidden; white-space: nowrap; text-overflow: ellipsis; cursor: pointer; }}
        .event-item:hover {{ background-color: #e2e8f0; }}
        .dept-badge {{ font-weight: 900; margin-left: 4px; white-space: nowrap; }}
        .dept-êµë¬´ {{ color: #3b82f6; }}
        .dept-ì—°êµ¬ {{ color: #8b5cf6; }}
        .dept-í•™ìƒ {{ color: #10b981; }}
        .dept-ì°½ì˜ {{ color: #f59e0b; }}
        .dept-í–‰ì • {{ color: #14b8a6; }}
        .holiday-badge {{ font-size: 10px; color: #dc2626; font-weight: 700; margin-top: 2px; }}
        .text-sun {{ color: #ef4444; }} .text-sat {{ color: #3b82f6; }}
        .del-x {{ color: #ef4444; cursor: pointer; margin-left: 4px; font-weight: bold; opacity: 0.7; }}
        .del-x:hover {{ opacity: 1; }}
        .year-view {{ display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 16px; }}
        .year-month {{ background: white; padding: 16px; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }}
        .year-month-title {{ font-weight: 900; color: #1e293b; margin-bottom: 8px; }}
        .mini-calendar {{ display: grid; grid-template-columns: repeat(7, 1fr); gap: 2px; font-size: 10px; }}
        .mini-day {{ padding: 4px; text-align: center; min-height: 30px; background: #f8fafc; border-radius: 4px; position: relative; }}
        .mini-day.has-event {{ background: #dbeafe; font-weight: 700; }}
        .mini-day.weekend {{ background: #fee2e2; }}
        .mini-day.holiday {{ background: #fef2f2; }}
        .mini-event {{ font-size: 7px; color: #4f46e5; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }}
        .week-item {{ background-color: white; }}
        .week-item.weekend-bg {{ background-color: #fef2f2 !important; }}
        .week-day-label {{ font-size: 10px; color: #64748b; margin-left: 4px; }}
        .sync-indicator {{ position: fixed; bottom: 20px; right: 20px; background: #4f46e5; color: white; padding: 8px 16px; border-radius: 20px; font-size: 11px; font-weight: 700; box-shadow: 0 4px 6px rgba(0,0,0,0.1); z-index: 1000; }}
        .sync-indicator.syncing {{ background: #f59e0b; animation: pulse 1s infinite; }}
        .sync-indicator.editing {{ background: #10b981; }}
        @keyframes pulse {{ 0%, 100% {{ opacity: 1; }} 50% {{ opacity: 0.5; }} }}
        .notice-section {{ background: white; padding: 16px; border-radius: 12px; margin-top: 16px; border: 2px solid #e2e8f0; }}
        .notice-item {{ margin-bottom: 12px; }}
        .notice-label {{ font-weight: 900; color: #4f46e5; font-size: 12px; margin-bottom: 4px; }}
        .notice-input-group {{ display: flex; gap: 8px; align-items: center; }}
        .notice-input {{ flex: 1; border: 1px solid #e2e8f0; border-radius: 8px; padding: 8px; font-size: 12px; outline: none; }}
        .notice-input:focus {{ border-color: #6366f1; background-color: #f0f9ff; }}
        .notice-input.has-content {{ background-color: #e8f5e9; border-color: #66bb6a; font-weight: 700; color: #1b5e20; }}
        .notice-btn {{ padding: 6px 12px; border-radius: 6px; font-size: 11px; font-weight: 700; cursor: pointer; transition: all 0.2s; white-space: nowrap; }}
        .notice-btn-save {{ background: #3b82f6; color: white; }}
        .notice-btn-save:hover {{ background: #2563eb; }}
        .notice-btn-delete {{ background: #ef4444; color: white; }}
        .notice-btn-delete:hover {{ background: #dc2626; }}
        .admin-badge {{ position: fixed; top: 20px; right: 20px; background: #ef4444; color: white; padding: 6px 12px; border-radius: 12px; font-size: 10px; font-weight: 900; z-index: 1000; }}
        .modal {{ display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 2000; justify-content: center; align-items: center; }}
        .modal.active {{ display: flex; }}
        .modal-content {{ background: white; border-radius: 16px; padding: 24px; max-width: 90%; max-height: 80%; overflow-y: auto; box-shadow: 0 20px 60px rgba(0,0,0,0.3); }}
        .modal-title {{ font-size: 18px; font-weight: 900; color: #1e293b; margin-bottom: 16px; }}
        .modal-close {{ position: absolute; top: 12px; right: 12px; font-size: 24px; cursor: pointer; color: #94a3b8; }}
        .modal-close:hover {{ color: #ef4444; }}
        .login-form {{ max-width: 400px; }}
        .login-input {{ width: 100%; padding: 12px; border: 2px solid #e2e8f0; border-radius: 8px; margin-bottom: 12px; font-size: 14px; }}
        .login-btn {{ width: 100%; padding: 12px; background: #4f46e5; color: white; border: none; border-radius: 8px; font-weight: 700; cursor: pointer; }}
        .login-btn:hover {{ background: #4338ca; }}
    </style>
</head>
<body class="p-3">
    <div class="max-w-4xl mx-auto">
        <header class="flex justify-between items-center mb-6 bg-indigo-900 p-4 rounded-2xl text-white shadow-lg">
            <h1 class="font-black">ğŸ« êµ¬ë¡€ì¤‘ í•™ì‚¬ë ¥</h1>
            <div class="flex gap-2 items-center">
                <button onclick="app.showLoginModal()" class="text-xs bg-indigo-700 px-3 py-1.5 rounded-lg font-bold">ğŸ” ê´€ë¦¬ì</button>
                <button onclick="app.setView('weekly')" class="text-xs bg-indigo-700 px-3 py-1.5 rounded-lg font-bold">ì£¼ê°„</button>
                <button onclick="app.setView('monthly')" class="text-xs bg-indigo-700 px-3 py-1.5 rounded-lg font-bold">ì›”ê°„</button>
                <button onclick="app.setView('yearly')" class="text-xs bg-indigo-700 px-3 py-1.5 rounded-lg font-bold">ì—°ê°„</button>
            </div>
        </header>

        <section class="bg-white p-4 rounded-2xl shadow-sm border mb-4 grid grid-cols-2 md:grid-cols-4 gap-2">
            <input type="date" id="inDate" class="border p-2 rounded-xl text-sm outline-none">
            <input type="text" id="inTitle" placeholder="í–‰ì‚¬ë‚´ìš©" class="border p-2 rounded-xl text-sm outline-none">
            <select id="inDept" class="border p-2 rounded-xl text-sm outline-none">
                <option>êµë¬´</option><option>ì—°êµ¬</option><option>í•™ìƒ</option><option>ì°½ì˜</option><option>í–‰ì •</option>
            </select>
            <button onclick="app.saveEvent()" class="bg-indigo-600 text-white rounded-xl font-bold py-2">ì €ì¥í•˜ê¸°</button>
        </section>

        <div class="flex justify-between items-center bg-white p-3 rounded-2xl border mb-4">
            <button onclick="app.move(-1)" class="text-indigo-600 font-bold px-4">â®</button>
            <h2 id="titleText" class="text-lg font-black text-slate-700">ë¡œë”© ì¤‘...</h2>
            <button onclick="app.move(1)" class="text-indigo-600 font-bold px-4">â¯</button>
        </div>

        <div id="viewPort"></div>
        <div id="weeklyNotices" style="display:none;"></div>

        <footer class="text-center py-8 text-slate-400 text-[10px]">
            Â© Choi Gwang-cheul, Gurye Middle School
        </footer>
    </div>

    <div id="adminBadge" class="admin-badge" style="display:none;">
        ğŸ” ê´€ë¦¬ì ëª¨ë“œ
        <button onclick="app.logout()" style="margin-left:8px; background:#dc2626; padding:2px 6px; border-radius:4px; font-size:9px;">ë¡œê·¸ì•„ì›ƒ</button>
    </div>

    <div id="syncIndicator" class="sync-indicator">â— ë™ê¸°í™” ì™„ë£Œ</div>

    <div id="loginModal" class="modal">
        <div class="modal-content login-form" style="position:relative;">
            <span class="modal-close" onclick="app.closeModal('loginModal')">&times;</span>
            <div class="modal-title">ğŸ” ê´€ë¦¬ì ë¡œê·¸ì¸</div>
            <input type="text" id="adminId" class="login-input" placeholder="ì•„ì´ë””" value="admin">
            <input type="password" id="adminPw" class="login-input" placeholder="ë¹„ë°€ë²ˆí˜¸" value="1234">
            <button class="login-btn" onclick="app.login()">ë¡œê·¸ì¸</button>
            <div id="loginError" style="color:#ef4444; font-size:12px; margin-top:8px; display:none;"></div>
        </div>
    </div>

    <div id="eventModal" class="modal">
        <div class="modal-content" style="position:relative; max-width:600px;">
            <span class="modal-close" onclick="app.closeModal('eventModal')">&times;</span>
            <div id="eventModalContent"></div>
        </div>
    </div>

    <script>
        const app = {{
            API_URL: '{new_api_url}',
            
            events: [],
            notices: {{}},
            currentDate: new Date(),
            viewMode: 'weekly',
            isEditing: false,
            lastSyncTime: 0,
            isAdmin: false,
            
            holidays: [
                '2026-01-01:ì‹ ì •',
                '2026-02-16:ì„¤ë‚ ì—°íœ´',
                '2026-02-17:ì„¤ë‚ ',
                '2026-02-18:ì„¤ë‚ ì—°íœ´',
                '2026-03-01:ì‚¼ì¼ì ˆ',
                '2026-03-02:ì‚¼ì¼ì ˆ ëŒ€ì²´íœ´ì¼',
                '2026-05-05:ì–´ë¦°ì´ë‚ ',
                '2026-05-24:ë¶€ì²˜ë‹˜ì˜¤ì‹ ë‚ ',
                '2026-05-25:ë¶€ì²˜ë‹˜ì˜¤ì‹ ë‚  ëŒ€ì²´íœ´ì¼',
                '2026-06-06:í˜„ì¶©ì¼',
                '2026-08-15:ê´‘ë³µì ˆ',
                '2026-09-24:ì¶”ì„ì—°íœ´',
                '2026-09-25:ì¶”ì„',
                '2026-09-26:ì¶”ì„ì—°íœ´',
                '2026-10-03:ê°œì²œì ˆ',
                '2026-10-09:í•œê¸€ë‚ ',
                '2026-12-25:í¬ë¦¬ìŠ¤ë§ˆìŠ¤'
            ],
            
            dayNames: ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '],
            
            deptColors: {{
                'êµë¬´': 'dept-êµë¬´',
                'ì—°êµ¬': 'dept-ì—°êµ¬',
                'í•™ìƒ': 'dept-í•™ìƒ',
                'ì°½ì˜': 'dept-ì°½ì˜',
                'í–‰ì •': 'dept-í–‰ì •'
            }},
            
            getHoliday(dateStr) {{
                const found = this.holidays.find(h => h.startsWith(dateStr + ':'));
                return found ? found.split(':')[1] : null;
            }},
            
            getDayName(date) {{
                return this.dayNames[date.getDay()];
            }},
            
            setSyncStatus(status) {{
                const indicator = document.getElementById('syncIndicator');
                if (status === 'editing') {{
                    indicator.className = 'sync-indicator editing';
                    indicator.textContent = 'âœ ì…ë ¥ ì¤‘...';
                }} else if (status === 'syncing') {{
                    indicator.className = 'sync-indicator syncing';
                    indicator.textContent = 'â— ë™ê¸°í™” ì¤‘...';
                }} else if (status === 'success') {{
                    indicator.className = 'sync-indicator';
                    indicator.textContent = 'â— ë™ê¸°í™” ì™„ë£Œ';
                }} else if (status === 'error') {{
                    indicator.className = 'sync-indicator';
                    indicator.style.background = '#ef4444';
                    indicator.textContent = 'â— ì˜¤ë¥˜ ë°œìƒ';
                }}
            }},
            
            getWeekKey(date = this.currentDate) {{
                const d = new Date(date);
                const day = d.getDay();
                const offset = day === 0 ? -6 : -(day - 1);
                d.setDate(d.getDate() + offset);
                return `${{d.getFullYear()}}-${{String(d.getMonth() + 1).padStart(2, '0')}}-${{String(d.getDate()).padStart(2, '0')}}`;
            }},
            
            getMondayOfWeek(date = this.currentDate) {{
                const d = new Date(date);
                const day = d.getDay();
                const offset = day === 0 ? -6 : -(day - 1);
                d.setDate(d.getDate() + offset);
                return d;
            }},
            
            showLoginModal() {{
                document.getElementById('loginModal').classList.add('active');
            }},
            
            closeModal(modalId) {{
                document.getElementById(modalId).classList.remove('active');
            }},
            
            login() {{
                const id = document.getElementById('adminId').value;
                const pw = document.getElementById('adminPw').value;
                
                if (id === 'admin' && pw === '1234') {{
                    this.isAdmin = true;
                    document.getElementById('adminBadge').style.display = 'block';
                    this.closeModal('loginModal');
                    alert('ê´€ë¦¬ì ë¡œê·¸ì¸ ì„±ê³µ!\\në‹¬ë ¥ ë‚ ì§œë¥¼ í´ë¦­í•˜ë©´ íœ´ì—…ì¼ì„ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                    this.render();
                }} else {{
                    document.getElementById('loginError').textContent = 'ì•„ì´ë”” ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.';
                    document.getElementById('loginError').style.display = 'block';
                }}
            }},
            
            logout() {{
                if (confirm('ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {{
                    this.isAdmin = false;
                    document.getElementById('adminBadge').style.display = 'none';
                    alert('ë¡œê·¸ì•„ì›ƒ ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    this.render();
                }}
            }},
            
            showEventModal(dateStr) {{
                const dayEvents = this.events.filter(e => e.date === dateStr);
                const holiday = this.getHoliday(dateStr);
                
                const date = new Date(dateStr);
                const dayName = this.getDayName(date);
                
                let html = `
                    <div class="modal-title">${{date.getMonth()+1}}ì›” ${{date.getDate()}}ì¼ (${{dayName}})</div>
                `;
                
                if (holiday) {{
                    html += `<div style="color:#ef4444; font-weight:700; margin-bottom:12px;">ğŸŠ ${{holiday}}</div>`;
                }}
                
                if (dayEvents.length === 0) {{
                    html += `<div style="color:#94a3b8; padding:20px; text-align:center;">ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤.</div>`;
                }} else {{
                    html += `<div style="margin-top:12px;">`;
                    dayEvents.forEach(e => {{
                        const deptColorClass = this.deptColors[e.dapt] || 'dept-êµë¬´';
                        html += `
                            <div style="background:#f8fafc; padding:12px; border-radius:8px; margin-bottom:8px; border-left:4px solid #6366f1;">
                                <div style="font-weight:700; color:#1e293b; margin-bottom:4px;">${{e.title}}</div>
                                <div style="font-size:12px;">
                                    <span class="dept-badge ${{deptColorClass}}">ë‹´ë‹¹: ${{e.dapt}}</span>
                                </div>
                            </div>
                        `;
                    }});
                    html += `</div>`;
                }}
                
                document.getElementById('eventModalContent').innerHTML = html;
                document.getElementById('eventModal').classList.add('active');
            }},
            
            async saveToServer(action, data) {{
                try {{
                    this.setSyncStatus('syncing');
                    console.log('ğŸ’¾ [ì €ì¥ ì‹œì‘]', action, data);
                    
                    const response = await fetch(this.API_URL, {{
                        method: 'POST',
                        body: JSON.stringify({{ action, ...data }})
                    }});
                    
                    console.log('ğŸ“¥ ì‘ë‹µ ìƒíƒœ:', response.status);
                    
                    if (!response.ok) {{
                        throw new Error(`HTTP ${{response.status}}`);
                    }}
                    
                    const result = await response.json();
                    console.log('âœ… ì €ì¥ ì‘ë‹µ:', result);
                    
                    if (result.success === false) {{
                        throw new Error(result.error || 'ì €ì¥ ì‹¤íŒ¨');
                    }}
                    
                    this.setSyncStatus('success');
                    
                    setTimeout(async () => {{
                        this.isEditing = false;
                        await this.loadFromServer();
                    }}, 1000);
                    
                    return result;
                }} catch (error) {{
                    console.error('âŒ [ì €ì¥ ì‹¤íŒ¨]', error);
                    this.setSyncStatus('error');
                    alert(`ì €ì¥ ì‹¤íŒ¨: ${{error.message}}`);
                    throw error;
                }}
            }},
            
            async loadFromServer() {{
                const now = Date.now();
                if (this.isEditing || (now - this.lastSyncTime < 1000)) {{
                    return;
                }}
                
                try {{
                    this.setSyncStatus('syncing');
                    console.log('ğŸ“¥ [ë¡œë“œ ì‹œì‘]');
                    
                    const response = await fetch(this.API_URL + '?action=load&t=' + Date.now());
                    
                    console.log('ğŸ“¥ ì‘ë‹µ ìƒíƒœ:', response.status);
                    
                    if (!response.ok) {{
                        throw new Error(`HTTP ${{response.status}}`);
                    }}
                    
                    const data = await response.json();
                    console.log('âœ… ë¡œë“œ ë°ì´í„°:', data);
                    
                    this.events = (data.events || []).map(item => {{
                        let dateStr = item.date;
                        if (typeof dateStr === 'string' && dateStr.includes('T')) {{
                            dateStr = dateStr.split('T')[0];
                        }} else if (typeof dateStr === 'string') {{
                            dateStr = dateStr.substring(0, 10);
                        }}
                        return {{
                            id: String(item.id),
                            date: dateStr,
                            title: item.title,
                            dapt: item.dapt
                        }};
                    }});
                    
                    if (data.notices && typeof data.notices === 'object') {{
                        this.notices = {{ ...data.notices }};
                    }}
                    
                    this.lastSyncTime = now;
                    this.setSyncStatus('success');
                    this.render();
                }} catch (error) {{
                    console.error('âŒ [ë¡œë“œ ì‹¤íŒ¨]', error);
                    this.setSyncStatus('error');
                }}
            }},
            
            async saveEvent() {{
                const dateInput = document.getElementById('inDate').value;
                const title = document.getElementById('inTitle').value;
                const dapt = document.getElementById('inDept').value;
                
                if (!dateInput || !title) {{
                    alert('ë‚ ì§œì™€ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”.');
                    return;
                }}
                
                const newEvent = {{
                    id: Date.now().toString(),
                    date: dateInput,
                    title: title,
                    dapt: dapt
                }};
                
                this.events.push(newEvent);
                this.render();
                await this.saveToServer('addEvent', newEvent);
                
                document.getElementById('inDate').value = '';
                document.getElementById('inTitle').value = '';
            }},
            
            async deleteEvent(id) {{
                if (!confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
                this.events = this.events.filter(e => e.id !== id);
                this.render();
                await this.saveToServer('deleteEvent', {{ id }});
            }},
            
            async toggleHoliday(dateStr) {{
                if (!this.isAdmin) {{
                    this.showEventModal(dateStr);
                    return;
                }}
                
                const existing = this.events.find(e => e.date === dateStr && e.title === 'íœ´ì—…ì¼');
                
                if (existing) {{
                    if (confirm('íœ´ì—…ì¼ì„ í•´ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {{
                        await this.deleteEvent(existing.id);
                    }}
                }} else {{
                    if (confirm('íœ´ì—…ì¼ë¡œ ì§€ì •í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {{
                        const newEvent = {{
                            id: Date.now().toString(),
                            date: dateStr,
                            title: 'íœ´ì—…ì¼',
                            dapt: 'í•™ì‚¬'
                        }};
                        this.events.push(newEvent);
                        this.render();
                        await this.saveToServer('addEvent', newEvent);
                    }}
                }}
            }},
            
            handleNoticeInput(role) {{
                const weekKey = this.getWeekKey();
                const input = document.getElementById(`notice_${{role}}`);
                if (!input) return;
                
                const value = input.value;
                
                if (!this.notices[weekKey]) {{
                    this.notices[weekKey] = {{}};
                }}
                this.notices[weekKey][role] = value;
                
                input.classList.remove('has-content');
                if (value.trim()) {{
                    input.classList.add('has-content');
                }}
                
                this.isEditing = true;
                this.setSyncStatus('editing');
            }},
            
            async saveNoticeBtn(role) {{
                const weekKey = this.getWeekKey();
                const input = document.getElementById(`notice_${{role}}`);
                if (!input) return;
                
                const value = input.value.trim();
                
                if (!this.notices[weekKey]) {{
                    this.notices[weekKey] = {{}};
                }}
                this.notices[weekKey][role] = value;
                
                try {{
                    await this.saveToServer('saveNotice', {{
                        weekKey,
                        role,
                        content: value
                    }});
                    
                    if (value) {{
                        input.classList.add('has-content');
                    }}
                    
                    alert('ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
                }} catch (error) {{
                    // ì—ëŸ¬ëŠ” saveToServerì—ì„œ ì²˜ë¦¬
                }}
            }},
            
            async deleteNoticeBtn(role) {{
                if (!confirm('ì´ ì•ˆë‚´ì‚¬í•­ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
                
                const weekKey = this.getWeekKey();
                const input = document.getElementById(`notice_${{role}}`);
                if (!input) return;
                
                if (this.notices[weekKey]) {{
                    delete this.notices[weekKey][role];
                }}
                
                input.value = '';
                input.classList.remove('has-content');
                
                await this.saveToServer('saveNotice', {{
                    weekKey,
                    role,
                    content: ''
                }});
                
                alert('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤!');
            }},
            
            move(direction) {{
                if (this.viewMode === 'yearly') {{
                    this.currentDate.setFullYear(this.currentDate.getFullYear() + direction);
                }} else if (this.viewMode === 'monthly') {{
                    this.currentDate.setMonth(this.currentDate.getMonth() + direction);
                }} else {{
                    this.currentDate.setDate(this.currentDate.getDate() + (direction * 7));
                }}
                this.render();
            }},
            
            setView(mode) {{
                this.viewMode = mode;
                this.render();
            }},
            
            renderYearly() {{
                const year = this.currentDate.getFullYear();
                let html = '<div class="year-view">';
                
                for (let m = 0; m < 12; m++) {{
                    html += `<div class="year-month">
                        <div class="year-month-title">${{year}}ë…„ ${{m + 1}}ì›”</div>
                        <div class="mini-calendar">`;
                    
                    ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '].forEach(w => {{
                        html += `<div class="text-[9px] text-slate-400 font-bold text-center p-1">${{w}}</div>`;
                    }});
                    
                    const first = new Date(year, m, 1).getDay();
                    const last = new Date(year, m + 1, 0).getDate();
                    
                    for (let i = 0; i < first; i++) html += '<div></div>';
                    
                    for (let d = 1; d <= last; d++) {{
                        const dateStr = `${{year}}-${{String(m + 1).padStart(2, '0')}}-${{String(d).padStart(2, '0')}}`;
                        const dayIdx = new Date(year, m, d).getDay();
                        const dayEvents = this.events.filter(e => e.date === dateStr);
                        const holiday = this.getHoliday(dateStr);
                        const isWeekend = dayIdx === 0 || dayIdx === 6;
                        const isHoliday = dayEvents.some(e => e.title === 'íœ´ì—…ì¼');
                        const colorClass = dayIdx === 0 || holiday ? 'text-sun' : (dayIdx === 6 ? 'text-sat' : 'text-slate-600');
                        
                        let cellClass = '';
                        if (holiday || isHoliday || isWeekend) {{
                            cellClass = 'holiday';
                        }} else if (dayEvents.length > 0) {{
                            cellClass = 'has-event';
                        }}
                        
                        html += `<div class="mini-day ${{cellClass}} ${{colorClass}}" onclick="app.showEventModal('${{dateStr}}')" style="cursor:pointer;" title="${{dayEvents.map(e => e.title).join(', ')}}">
                            ${{d}}`;
                        
                        if (dayEvents.length > 0) {{
                            const shortTitle = dayEvents[0].title.substring(0, 3);
                            html += `<div class="mini-event">${{shortTitle}}</div>`;
                        }}
                        
                        html += `</div>`;
                    }}
                    
                    html += '</div></div>';
                }}
                
                return html + '</div>';
            }},
            
            renderMonthly() {{
                const year = this.currentDate.getFullYear();
                const month = this.currentDate.getMonth();
                let html = '<div class="calendar-grid">';
                
                ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '].forEach(w => {{
                    html += `<div class="bg-slate-50 p-2 text-center text-[11px] font-bold text-slate-400">${{w}}</div>`;
                }});
                
                const first = new Date(year, month, 1).getDay();
                const last = new Date(year, month + 1, 0).getDate();
                
                for (let i = 0; i < first; i++) {{
                    html += '<div class="day-cell bg-slate-50/30"></div>';
                }}
                
                for (let d = 1; d <= last; d++) {{
                    const dateStr = `${{year}}-${{String(month + 1).padStart(2, '0')}}-${{String(d).padStart(2, '0')}}`;
                    const dayIdx = new Date(year, month, d).getDay();
                    const holiday = this.getHoliday(dateStr);
                    const isWeekend = dayIdx === 0 || dayIdx === 6;
                    const isHoliday = this.events.some(e => e.date === dateStr && e.title === 'íœ´ì—…ì¼');
                    const colorClass = dayIdx === 0 || holiday ? 'text-sun' : (dayIdx === 6 ? 'text-sat' : 'text-slate-400');
                    const cellClass = (isWeekend || holiday || isHoliday) ? 'weekend-cell' : '';
                    const adminClass = this.isAdmin ? 'admin-mode' : '';
                    
                    html += `<div class="day-cell ${{cellClass}} ${{adminClass}}" onclick="app.toggleHoliday('${{dateStr}}')">
                        <div class="text-[11px] font-black ${{colorClass}}">${{d}}</div>`;
                    
                    if (holiday) {{
                        html += `<div class="holiday-badge">${{holiday}}</div>`;
                    }}
                    
                    html += '<div class="mt-1">';
                    
                    this.events.filter(e => e.date === dateStr).forEach(e => {{
                        const deptColorClass = this.deptColors[e.dapt] || 'dept-êµë¬´';
                        const shortTitle = e.title.substring(0, 3);
                        html += `<div class="event-item" title="${{e.title}}" onclick="event.stopPropagation(); app.showEventModal('${{dateStr}}')">
                            <span class="event-title">${{shortTitle}} <span class="dept-badge ${{deptColorClass}}">(${{e.dapt}})</span></span>
                        </div>`;
                    }});
                    
                    html += '</div></div>';
                }}
                
                return html + '</div>';
            }},
            
            renderWeekly() {{
                const start = new Date(this.currentDate);
                start.setDate(this.currentDate.getDate() - this.currentDate.getDay());
                
                let html = '<div class="flex flex-col gap-2">';
                
                for (let i = 0; i < 7; i++) {{
                    const d = new Date(start);
                    d.setDate(start.getDate() + i);
                    
                    const year = d.getFullYear();
                    const month = String(d.getMonth() + 1).padStart(2, '0');
                    const day = String(d.getDate()).padStart(2, '0');
                    const dateStr = `${{year}}-${{month}}-${{day}}`;
                    
                    const holiday = this.getHoliday(dateStr);
                    const isWeekend = d.getDay() === 0 || d.getDay() === 6;
                    const isHoliday = this.events.some(e => e.date === dateStr && e.title === 'íœ´ì—…ì¼');
                    
                    const dayName = this.getDayName(d);
                    const dayColor = d.getDay() === 0 ? 'text-red-500' : (d.getDay() === 6 ? 'text-blue-500' : 'text-slate-500');
                    const weekendClass = (isWeekend || holiday || isHoliday) ? 'weekend-bg' : '';
                    
                    html += `<div class="week-item ${{weekendClass}} p-4 rounded-xl border flex items-center shadow-sm">
                        <div class="w-32 font-black text-indigo-900 border-r mr-4">
                            ${{d.getDate()}}ì¼
                            <span class="week-day-label ${{dayColor}}">(${{dayName}})</span>`;
                    
                    if (holiday) {{
                        html += `<div class="holiday-badge text-[9px]">${{holiday}}</div>`;
                    }}
                    
                    html += '</div><div class="flex-1">';
                    
                    this.events.filter(e => e.date === dateStr).forEach(e => {{
                        const deptColorClass = this.deptColors[e.dapt] || 'dept-êµë¬´';
                        html += `<div class="event-item mb-1 p-2" style="display:flex; justify-content:space-between;">
                            <span>${{e.title}} <span class="dept-badge ${{deptColorClass}}">(${{e.dapt}})</span></span>
                            <span class="del-x" onclick="app.deleteEvent('${{e.id}}')">âœ•</span>
                        </div>`;
                    }});
                    
                    html += '</div></div>';
                }}
                
                html += '</div>';
                
                const weekKey = this.getWeekKey();
                const monday = this.getMondayOfWeek();
                const weekNotices = this.notices[weekKey] || {{}};
                
                const roles = [
                    {{ id: 'principal', label: 'ğŸ“ êµì¥' }},
                    {{ id: 'vprincipal', label: 'ğŸ‘” êµê°' }},
                    {{ id: 'admin', label: 'ğŸ¢ í–‰ì •ì‹¤ì¥' }},
                    {{ id: 'dept1', label: 'ğŸ“˜ êµë¬´ë¶€' }},
                    {{ id: 'dept2', label: 'ğŸ“• ì—°êµ¬ë¶€' }},
                    {{ id: 'dept3', label: 'ğŸ“— í•™ìƒë¶€' }},
                    {{ id: 'dept4', label: 'ğŸ“™ ì°½ì˜ì¸ì„±ë¶€' }},
                    {{ id: 'grade', label: 'ğŸ¯ í•™ë…„ì‹¤' }}
                ];
                
                let noticeHtml = `
                    <div class="notice-section">
                        <h3 class="font-black text-indigo-900 mb-4">ğŸ“¢ ì£¼ê°„ ì•ˆë‚´ì‚¬í•­ (${{monday.getFullYear()}}.${{String(monday.getMonth() + 1).padStart(2, '0')}}.${{String(monday.getDate()).padStart(2, '0')}}~)</h3>
                        <div class="text-xs text-emerald-600 mb-2">ğŸ’¡ ì…ë ¥í•˜ë©´ ìë™ ì €ì¥ë©ë‹ˆë‹¤. [ì €ì¥] ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ë‹¤ë¥¸ ê¸°ê¸°ì—ì„œë„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div>
                `;
                
                roles.forEach(role => {{
                    const value = weekNotices[role.id] || '';
                    const hasContent = value.trim() ? 'has-content' : '';
                    
                    noticeHtml += `
                        <div class="notice-item">
                            <div class="notice-label">${{role.label}}</div>
                            <div class="notice-input-group">
                                <input type="text" id="notice_${{role.id}}" class="notice-input ${{hasContent}}" 
                                       value="${{value}}" 
                                       oninput="app.handleNoticeInput('${{role.id}}')"
                                       placeholder="${{role.label}} ì•ˆë‚´ì‚¬í•­ ì…ë ¥">
                                <button class="notice-btn notice-btn-save" onclick="app.saveNoticeBtn('${{role.id}}')">ì €ì¥</button>
                                <button class="notice-btn notice-btn-delete" onclick="app.deleteNoticeBtn('${{role.id}}')">ì‚­ì œ</button>
                            </div>
                        </div>
                    `;
                }});
                
                noticeHtml += '</div>';
                
                document.getElementById('weeklyNotices').innerHTML = noticeHtml;
                document.getElementById('weeklyNotices').style.display = 'block';
                
                return html;
            }},
            
            render() {{
                const viewPort = document.getElementById('viewPort');
                const titleText = document.getElementById('titleText');
                const weeklyNotices = document.getElementById('weeklyNotices');
                
                const year = this.currentDate.getFullYear();
                const month = this.currentDate.getMonth() + 1;
                
                if (this.viewMode === 'yearly') {{
                    titleText.textContent = `${{year}}ë…„ ì „ì²´ í•™ì‚¬ë ¥`;
                    viewPort.innerHTML = this.renderYearly();
                    weeklyNotices.style.display = 'none';
                }} else if (this.viewMode === 'monthly') {{
                    titleText.textContent = `${{year}}ë…„ ${{month}}ì›”`;
                    viewPort.innerHTML = this.renderMonthly();
                    weeklyNotices.style.display = 'none';
                }} else {{
                    titleText.textContent = `${{year}}ë…„ ${{month}}ì›” ì£¼ê°„`;
                    viewPort.innerHTML = this.renderWeekly();
                }}
            }},
            
            async init() {{
                console.log('ğŸš€ [ì‹œìŠ¤í…œ ì‹œì‘]');
                console.log('ğŸ“ API URL:', this.API_URL);
                await this.loadFromServer();
                this.render();
                setInterval(() => {{
                    if (!this.isEditing) {{
                        this.loadFromServer();
                    }}
                }}, 10000);
            }}
        }};
        
        window.addEventListener('DOMContentLoaded', () => {{
            app.init();
        }});
    </script>
</body>
</html>
